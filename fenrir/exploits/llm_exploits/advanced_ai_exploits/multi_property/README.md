# ðŸ¦Š Multi-Property Inference Framework

A comprehensive framework for inferring multiple dataset properties simultaneously from fine-tuned language models, extending far beyond the single-property focus of the original PropInfer paper.

## Overview

This framework extends the PropInfer methodology to handle multiple properties simultaneously across diverse domains:

- **News Articles** (CNN, Reuters, BBC) for copyright and source inference
- **Medical Data** for demographic and clinical property inference
- **Financial Data** for business and market property inference
- **Legal Documents** for jurisdiction and compliance inference
- **Technical Documentation** for complexity and formality inference

## Key Features

### ðŸŽ¯ Multi-Property Inference

- Simultaneous inference of multiple dataset properties
- Cross-domain property analysis
- Property interaction modeling
- Advanced meta-attack model training

### ðŸ“Š Comprehensive Dataset Support

- HuggingFace dataset integration
- Synthetic dataset generation
- Multi-domain dataset management
- Property-specific dataset filtering

### ðŸ¦Š PROMPT Library

**Property Retrieval and Observation for Multi-Property Targeting**

Centralized prompt generation system with:

- Domain-specific prompt generators
- Multi-property prompt strategies
- Adversarial prompt optimization
- Prompt effectiveness tracking

### ðŸ”¥ VULCAN Integration

- Efficient LoRA fine-tuning for shadow models
- RTX 4090 optimized training
- PyTorch 2.8.0 optimizations (SDPA, torch.compile, BetterTransformer)
- Ollama + Qwen3-8B integration

## Architecture

```
multi_property/
â”œâ”€â”€ core/                          # Core framework components
â”‚   â”œâ”€â”€ multi_property_exploiter.py    # Main exploiter class
â”‚   â””â”€â”€ property_types.py              # Property type definitions
â”œâ”€â”€ datasets/                      # Dataset management
â”‚   â””â”€â”€ dataset_manager.py             # Multi-domain dataset manager
â”œâ”€â”€ prompts/                       # PROMPT library
â”‚   â”œâ”€â”€ prompt_library.py              # Centralized prompt generation
â”‚   â”œâ”€â”€ prompt_generators.py           # Domain-specific generators
â”‚   â”œâ”€â”€ prompt_templates.py            # Prompt templates
â”‚   â”œâ”€â”€ prompt_optimizer.py            # Prompt optimization
â”‚   â””â”€â”€ prompt_evaluator.py            # Prompt effectiveness evaluation
â”œâ”€â”€ models/                        # Model training components
â”‚   â”œâ”€â”€ shadow_model_trainer.py        # Shadow model training
â”‚   â””â”€â”€ meta_attack_trainer.py         # Meta-attack model training
â”œâ”€â”€ evaluation/                    # Evaluation and benchmarking
â”‚   â””â”€â”€ benchmark.py                   # Multi-property benchmark
â”œâ”€â”€ examples/                      # Usage examples
â”‚   â””â”€â”€ run_multi_property_attack.py   # Comprehensive demo
â””â”€â”€ utils/                         # Utilities
    â””â”€â”€ config.py                      # Configuration management
```

## Property Types

### Copyright & Source Properties

- `news_source`: Infer news source (CNN, Reuters, BBC, etc.)
- `copyright_status`: Determine copyright status
- `temporal_period`: Infer time periods from content

### Demographic Properties

- `gender_distribution`: Infer gender distribution
- `age_demographics`: Infer age demographics
- `geographic_region`: Infer geographic focus
- `socioeconomic_status`: Infer socioeconomic characteristics

### Content Properties

- `sentiment_bias`: Infer sentiment bias
- `political_leaning`: Infer political orientation
- `formality_level`: Infer formality of language
- `technical_complexity`: Infer technical complexity

### Business Properties

- `customer_segment`: Infer customer segments
- `industry_focus`: Infer industry focus
- `market_sector`: Infer market sectors
- `revenue_range`: Infer revenue ranges

### Security Properties

- `data_sensitivity`: Infer data sensitivity levels
- `compliance_framework`: Infer compliance frameworks
- `access_level`: Infer access restrictions

## Usage Examples

### Basic Multi-Property Attack

```python
from multi_property import MultiPropertyExploiter, MultiPropertyConfig
from multi_property.core.property_types import DomainType

# Configure multi-property attack
config = MultiPropertyConfig(
    target_properties=["news_source", "sentiment_bias", "copyright_status"],
    property_combinations=[
        ["news_source", "sentiment_bias"],
        ["copyright_status", "temporal_period"]
    ],
    primary_domain=DomainType.NEWS,
    base_datasets=["cnn_news", "reuters_news"],
    shadow_model_count=6
)

# Execute attack
exploiter = MultiPropertyExploiter(config)
results = await exploiter.execute_multi_property_attack()
```

### Cross-Domain Analysis

```python
# Cross-domain property inference
config = MultiPropertyConfig(
    target_properties=[
        "news_source", "gender_distribution", "industry_focus"
    ],
    cross_domain_analysis=True,
    base_datasets=["cnn_news", "medical_qa", "financial_reports"]
)

exploiter = MultiPropertyExploiter(config)
results = await exploiter.execute_multi_property_attack()
```

### PROMPT Library Usage

```python
from multi_property.prompts import PROMPTLibrary

prompt_lib = PROMPTLibrary()

# Generate diverse prompts for news domain
prompts = prompt_lib.generate_property_prompts(
    property_types=["news_source", "sentiment_bias"],
    domain="news",
    count=10,
    strategy="diverse"
)

# Generate multi-property prompts
multi_prompts = prompt_lib.generate_multi_property_prompts(
    property_combinations=[["news_source", "sentiment_bias"]],
    domain="news",
    count_per_combination=5
)
```

### Dataset Management

```python
from multi_property.datasets import DatasetManager

dataset_manager = DatasetManager()

# Load news dataset
news_data = dataset_manager.load_dataset("cnn_news", sample_size=1000)

# Create property-specific dataset
property_data = dataset_manager.create_property_dataset(
    base_dataset="cnn_news",
    target_properties=["news_source", "sentiment_bias"],
    property_ratios={"news_source": 0.7, "sentiment_bias": 0.3},
    sample_size=500
)
```

## Integration with FENRIR + PROWL + VULCAN

This framework seamlessly integrates with the existing FENRIR ecosystem:

- **FENRIR**: Provides the foundational exploit framework
- **PROWL**: Extends property inference capabilities
- **VULCAN**: Enables efficient shadow model training with LoRA

## Performance Optimizations

### RTX 4090 Optimizations

- PyTorch 2.8.0 with SDPA (Scaled Dot-Product Attention)
- `torch.compile` for model optimization
- BetterTransformer for enhanced attention
- Mixed precision training (bf16)
- Gradient checkpointing

### Training Performance

- **Shadow Model Training**: ~2-3 minutes per model
- **Meta-Attack Training**: ~30 seconds per model
- **Property Inference**: ~10 seconds per property combination
- **Memory Usage**: ~8-12GB VRAM

## Supported Datasets

### News Datasets

- CNN News Articles
- Reuters News
- BBC News
- New York Times
- Wall Street Journal

### Medical Datasets

- Medical Q&A pairs
- Clinical notes
- Patient records
- Medical literature

### Financial Datasets

- Financial reports
- Market data
- Company filings
- Economic indicators

### Legal Datasets

- Case law
- Legal regulations
- Court decisions
- Compliance documents

### Technical Datasets

- Technical documentation
- Code repositories
- API documentation
- System manuals

## Evaluation Metrics

- **Accuracy**: Property inference accuracy
- **Precision**: Precision for each property
- **Recall**: Recall for each property
- **F1-Score**: F1-score for each property
- **Confidence**: Confidence scores for predictions
- **Cross-Domain Performance**: Performance across domains

## Advanced Features

### Property Interaction Analysis

- Correlation analysis between properties
- Synergistic effect detection
- Property dependency modeling

### Adversarial Prompt Generation

- Optimized prompts for property extraction
- Context-aware prompt generation
- Multi-strategy prompt optimization

### Cross-Domain Transfer

- Property inference across domains
- Domain adaptation techniques
- Transfer learning for meta-attack models

## Research Applications

This framework enables research into:

1. **Copyright Detection**: Identifying copyrighted content in training data
2. **Demographic Bias**: Detecting demographic biases in models
3. **Source Attribution**: Identifying data sources from model outputs
4. **Compliance Analysis**: Detecting regulatory compliance in training data
5. **Cross-Domain Privacy**: Privacy inference across different domains

## Future Extensions

- **Real-time Property Inference**: Live property inference from model outputs
- **Federated Property Inference**: Distributed property inference across models
- **Adversarial Property Defense**: Defending against property inference attacks
- **Property-Aware Training**: Training models with property awareness

## Contributing

This framework is part of the FENRIR ecosystem. Contributions should follow the established patterns and integrate with the existing FENRIR + PROWL + VULCAN architecture.

## License

Part of the FENRIR project. See main project license for details.
