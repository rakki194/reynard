<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Yipyap Scripts Directory - Reynard Documentation Test</title>
  <link rel="stylesheet" href="../styles.css">
  <link rel="stylesheet" href="../highlight.css">
  <link rel="icon" href="/favicon.ico">
</head>
<body>
  <nav class="docs-nav">
    <div class="nav-brand"><a href="../index.html">Reynard Documentation Test</a></div>
    <div class="nav-links"><a href="../index.html">Home</a><a href="../api.html">API Reference</a></div>
  </nav>
  <main class="docs-main">
    <div class="docs-content">
      <h1>Yipyap Scripts Directory</h1>
      <div class="markdown-content"><h1>Yipyap Scripts Directory</h1>
<p>This directory contains utility scripts for testing and demonstrating yipyap<br>features, as well as maintenance and administration tools.</p>
<h2>NLWeb Integration Demo</h2>
<p>The <code>nlweb_demo.py</code> script demonstrates the complete NLWeb integration workflow,<br>showing how natural language queries are processed through router selection,<br>tool execution, and integrated response generation.</p>
<h3>Prerequisites</h3>
<ol>
<li><p>Ensure NLWeb integration is enabled:</p>
<pre><code class="hljs language-bash"><span class="hljs-built_in">export</span> NLWEB_ENABLED=<span class="hljs-literal">true</span>
<span class="hljs-built_in">export</span> NLWEB_CONFIG_DIR=config/nlweb</code></pre></li>
<li><p>Start the yipyap server:</p>
<pre><code class="hljs language-bash">DEV_PORT=7000 ROOT_DIR=<span class="hljs-variable">$HOME</span>/datasets NODE_ENV=development python -m app</code></pre></li>
</ol>
<h3>Basic Usage</h3>
<p>Run the demo with a default query:</p>
<pre><code class="hljs language-bash">python scripts/nlweb_demo.py</code></pre><p>Run with a custom query:</p>
<pre><code class="hljs language-bash">python scripts/nlweb_demo.py --query <span class="hljs-string">&quot;What&#x27;s the git status of this repository?&quot;</span></code></pre><p>Run with custom context:</p>
<pre><code class="hljs language-bash">python scripts/nlweb_demo.py --query <span class="hljs-string">&quot;List files in the current directory&quot;</span> --context-file scripts/demo_context.json</code></pre><h3>Example Queries</h3>
<p>Here are some example queries you can try:</p>
<p><strong>Git Operations:</strong></p>
<ul>
<li>&quot;What&#39;s the git status of this repository?&quot;</li>
<li>&quot;Show me the recent git commits&quot;</li>
<li>&quot;Check if there are any uncommitted changes&quot;</li>
</ul>
<p><strong>File Operations:</strong></p>
<ul>
<li>&quot;List files in the current directory&quot;</li>
<li>&quot;Show me the contents of the README file&quot;</li>
<li>&quot;Find all Python files in the project&quot;</li>
</ul>
<p><strong>Image Operations:</strong></p>
<ul>
<li>&quot;Generate captions for the selected images&quot;</li>
<li>&quot;What images are in the current directory?&quot;</li>
<li>&quot;Process the selected photos&quot;</li>
</ul>
<p><strong>System Information:</strong></p>
<ul>
<li>&quot;What&#39;s the current working directory?&quot;</li>
<li>&quot;Show system information&quot;</li>
<li>&quot;Check available disk space&quot;</li>
</ul>
<h3>Demo Output</h3>
<p>The script provides detailed output showing each phase of the NLWeb integration:</p>
<ol>
<li><strong>Router Selection</strong>: Shows the query, context, and tool suggestions with<br>scores</li>
<li><strong>Tool Execution</strong>: Displays each tool being executed with parameters and<br>results</li>
<li><strong>Integrated Response</strong>: Shows the final natural language response<br>incorporating tool results</li>
</ol>
<p>Example output:</p>
<pre><code class="hljs language-plaintext">üöÄ Starting NLWeb Integration Demo
==================================================
üîß Initializing NLWeb Demo...
‚úÖ NLWeb Demo initialized successfully

üéØ Phase 1: Router Selection
   Query: &#x27;What&#x27;s the git status of this repository?&#x27;
   Context: {
     &quot;current_path&quot;: &quot;/home/kade/yipyap&quot;,
     &quot;user_id&quot;: &quot;demo_user&quot;
   }
   ‚è±Ô∏è  Selection time: 245.3ms
   üìã Found 2 tool suggestions:
      1. git_status (score: 0.892)
         Parameters: {&quot;path&quot;: &quot;/home/kade/yipyap&quot;}

‚ö° Phase 2: Tool Execution
   üîß Executing tool 1: git_status
      Score: 0.892
      Parameters: {&quot;path&quot;: &quot;/home/kade/yipyap&quot;}
      ‚úÖ Success (45.2ms)
         Result: {&quot;status&quot;: &quot;clean&quot;, &quot;branch&quot;: &quot;main&quot;, &quot;ahead&quot;: 0, &quot;behind&quot;: 0}

ü§ñ Phase 3: Integrated Response
   üìù Tool execution summary:
      ‚Ä¢ git_status: executed successfully in 45.2ms
   üß† Generating integrated response...
      The git status of this repository shows that it&#x27;s clean on the main branch.
      There are no uncommitted changes, and you&#x27;re up to date with the remote repository.

üéâ Demo Complete!
==================================================</code></pre><h3>Troubleshooting</h3>
<p>If the demo fails to run:</p>
<ol>
<li><strong>NLWeb not enabled</strong>: Ensure <code>NLWEB_ENABLED=true</code> is set</li>
<li><strong>Service not available</strong>: Check that the yipyap server is running</li>
<li><strong>Configuration errors</strong>: Verify <code>config/nlweb/tools.xml</code> exists and is valid</li>
<li><strong>Tool registry issues</strong>: Ensure tools are properly registered</li>
</ol>
<p>For more detailed troubleshooting, see the<br><a href="../docs/nlweb-integration.md">NLWeb Integration Documentation</a>.</p>
<h3>Context File Format</h3>
<p>The demo context file (<code>demo_context.json</code>) can include:</p>
<ul>
<li><code>current_path</code>: Current working directory</li>
<li><code>user_id</code>: User identifier</li>
<li><code>session_id</code>: Session identifier</li>
<li><code>selected_images</code>: Array of selected image information</li>
<li><code>gallery_context</code>: Gallery-specific context</li>
<li><code>user_preferences</code>: User preferences</li>
<li><code>system_info</code>: System information</li>
</ul>
<p>Example context file:</p>
<pre><code class="hljs language-json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">&quot;current_path&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;/home/kade/yipyap&quot;</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;user_id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;demo_user&quot;</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;selected_images&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">&quot;path&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;/path/to/image.jpg&quot;</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">&quot;filename&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;image.jpg&quot;</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;gallery_context&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">&quot;current_directory&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;/path/to/gallery&quot;</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">&quot;selected_count&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span></code></pre><h2>Database Management</h2>
<h3>RAG Data Clearing</h3>
<p>The <code>clear_rag_data.py</code> script provides a standalone way to clear all RAG data<br>while preserving database structure.</p>
<h4>Features</h4>
<ul>
<li><strong>No backend required</strong>: Works independently of the YipYap application</li>
<li><strong>Multiple config sources</strong>: Supports DSN, config files, and environment files</li>
<li><strong>Safety features</strong>: Confirmation prompts and dry-run mode</li>
<li><strong>Comprehensive logging</strong>: Detailed output of all operations</li>
<li><strong>Error handling</strong>: Proper transaction management and rollback on errors</li>
</ul>
<h4>Usage</h4>
<pre><code class="hljs language-bash"><span class="hljs-comment"># Basic usage with environment variable</span>
<span class="hljs-built_in">export</span> PG_DSN=<span class="hljs-string">&quot;postgresql://user:pass@host:5432/dbname&quot;</span>
python scripts/clear_rag_data.py

<span class="hljs-comment"># With command line arguments</span>
python scripts/clear_rag_data.py --dsn <span class="hljs-string">&quot;postgresql://user:pass@host:5432/dbname&quot;</span>

<span class="hljs-comment"># Using config file</span>
python scripts/clear_rag_data.py --config config.json

<span class="hljs-comment"># Using environment file</span>
python scripts/clear_rag_data.py --env-file .<span class="hljs-built_in">env</span>

<span class="hljs-comment"># Preview what would be deleted (dry run)</span>
python scripts/clear_rag_data.py --dsn <span class="hljs-string">&quot;...&quot;</span> --dry-run

<span class="hljs-comment"># Skip confirmation prompt</span>
python scripts/clear_rag_data.py --dsn <span class="hljs-string">&quot;...&quot;</span> --force</code></pre><h4>Options</h4>
<ul>
<li><code>--dsn</code>: PostgreSQL connection string</li>
<li><code>--config</code>: Path to config.json file</li>
<li><code>--env-file</code>: Path to .env file</li>
<li><code>--dry-run</code>: Show what would be deleted without actually deleting</li>
<li><code>--force</code>: Skip confirmation prompt</li>
<li><code>--verbose</code>: Enable verbose logging</li>
</ul>
<h4>Requirements</h4>
<ul>
<li>Python 3.7+</li>
<li><code>psycopg2-binary</code> package (<code>pip install psycopg2-binary</code>)</li>
</ul>
<h4>Testing</h4>
<p>A test script is available to verify the functionality:</p>
<pre><code class="hljs language-bash">python scripts/test_clear_rag_data.py</code></pre><p>For more detailed information, see the<br><a href="../docs/rag-clear-data.md">RAG Data Clearing Documentation</a>.</p>
<h3>Database Schema</h3>
<p>The <code>db/</code> directory contains SQL migration files for the RAG system:</p>
<ul>
<li><code>001_pgvector.sql</code>: Ensures pgvector extension is installed</li>
<li><code>002_embeddings.sql</code>: Creates core RAG tables (documents, code, captions,<br>images)</li>
<li><code>003_indexes.sql</code>: Creates HNSW vector indexes</li>
<li><code>004_file_tracking.sql</code>: Creates file tracking and indexing session tables</li>
<li><code>005_root_dir_tracking.sql</code>: Adds file hash column for change detection</li>
</ul>
</div>
    </div>
  </main>
  <footer class="docs-footer"><p>&copy; 2024 Reynard Documentation Test. Built with ‚ù§Ô∏è using SolidJS.</p></footer>
</body>
</html>