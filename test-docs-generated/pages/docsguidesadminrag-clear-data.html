<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Clearing RAG Data - Reynard Documentation Test</title>
  <link rel="stylesheet" href="../styles.css">
  <link rel="stylesheet" href="../highlight.css">
  <link rel="icon" href="/favicon.ico">
</head>
<body>
  <nav class="docs-nav">
    <div class="nav-brand"><a href="../index.html">Reynard Documentation Test</a></div>
    <div class="nav-links"><a href="../index.html">Home</a><a href="../api.html">API Reference</a></div>
  </nav>
  <main class="docs-main">
    <div class="docs-content">
      <h1>Clearing RAG Data</h1>
      <div class="markdown-content"><h1>Clearing RAG Data</h1>
<p>This document explains how to clear all RAG data while preserving the database<br>structure in YipYap.</p>
<h2>Overview</h2>
<p>The RAG system stores data across multiple tables including documents, code<br>files, captions, images, and their embeddings. Sometimes you may want to start<br>fresh with your data while keeping the database schema intact.</p>
<h2>Methods to Clear RAG Data</h2>
<h3>1. Using the Web Interface (Recommended)</h3>
<ol>
<li>Navigate to <strong>Settings</strong> → <strong>RAG Settings</strong></li>
<li>Scroll down to the <strong>Queue Management</strong> section</li>
<li>Click the <strong>&quot;Clear All Data&quot;</strong> button</li>
<li>Confirm the action when prompted</li>
</ol>
<p>This will:</p>
<ul>
<li>Stop any ongoing indexing operations</li>
<li>Clear all data from RAG tables</li>
<li>Reset sequence counters</li>
<li>Preserve all table structures, indexes, and triggers</li>
</ul>
<h3>2. Using the API Endpoint</h3>
<p>You can also clear the data programmatically using the admin API:</p>
<pre><code class="hljs language-bash">curl -X POST <span class="hljs-string">&quot;http://localhost:7000/api/rag/admin/clear-all-data&quot;</span> \
  -H <span class="hljs-string">&quot;Authorization: Bearer YOUR_ADMIN_TOKEN&quot;</span></code></pre><p><strong>Response:</strong></p>
<pre><code class="hljs language-json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">&quot;status&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;success&quot;</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;message&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;All RAG data cleared successfully&quot;</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;total_records_deleted&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1250</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;deletion_counts&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">&quot;rag_document_embeddings&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">500</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">&quot;rag_code_embeddings&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">300</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">&quot;rag_caption_embeddings&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">200</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">&quot;rag_image_embeddings&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">&quot;rag_document_chunks&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">400</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">&quot;rag_code_chunks&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">250</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">&quot;rag_documents&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">150</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">&quot;rag_code_files&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">&quot;rag_captions&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">200</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">&quot;rag_images&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">&quot;rag_file_tracking&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">50</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">&quot;rag_indexing_sessions&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">10</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span></code></pre><h3>3. Using the Standalone Script (Recommended for Automation)</h3>
<p>For automation, maintenance scripts, or when the backend is not running, use the<br>standalone script:</p>
<pre><code class="hljs language-bash"><span class="hljs-comment"># Using environment variable</span>
<span class="hljs-built_in">export</span> PG_DSN=<span class="hljs-string">&quot;postgresql://yipyap:yipyap@localhost:5432/yipyap&quot;</span>
python scripts/clear_rag_data.py

<span class="hljs-comment"># Using command line argument</span>
python scripts/clear_rag_data.py --dsn <span class="hljs-string">&quot;postgresql://yipyap:yipyap@localhost:5432/yipyap&quot;</span>

<span class="hljs-comment"># Using config file</span>
python scripts/clear_rag_data.py --config config.json

<span class="hljs-comment"># Using environment file</span>
python scripts/clear_rag_data.py --env-file .<span class="hljs-built_in">env</span>

<span class="hljs-comment"># Preview what would be deleted (dry run)</span>
python scripts/clear_rag_data.py --dsn <span class="hljs-string">&quot;postgresql://...&quot;</span> --dry-run

<span class="hljs-comment"># Skip confirmation prompt</span>
python scripts/clear_rag_data.py --dsn <span class="hljs-string">&quot;postgresql://...&quot;</span> --force</code></pre><p><strong>Script Features:</strong></p>
<ul>
<li><strong>No backend required</strong>: Works independently of the YipYap application</li>
<li><strong>Multiple config sources</strong>: Supports DSN, config files, and environment files</li>
<li><strong>Safety features</strong>: Confirmation prompts and dry-run mode</li>
<li><strong>Comprehensive logging</strong>: Detailed output of all operations</li>
<li><strong>Error handling</strong>: Proper transaction management and rollback on errors</li>
</ul>
<h3>4. Using PostgreSQL Directly</h3>
<p>If you prefer to clear data directly in the database:</p>
<pre><code class="hljs language-sql"><span class="hljs-comment">-- Stop any ongoing operations first</span>
<span class="hljs-comment">-- Then run these commands in order:</span>

<span class="hljs-comment">-- Clear embeddings (they reference chunks)</span>
<span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">FROM</span> rag_document_embeddings;
<span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">FROM</span> rag_code_embeddings;
<span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">FROM</span> rag_caption_embeddings;
<span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">FROM</span> rag_image_embeddings;

<span class="hljs-comment">-- Clear chunks (they reference documents/files)</span>
<span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">FROM</span> rag_document_chunks;
<span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">FROM</span> rag_code_chunks;

<span class="hljs-comment">-- Clear main content tables</span>
<span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">FROM</span> rag_documents;
<span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">FROM</span> rag_code_files;
<span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">FROM</span> rag_captions;
<span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">FROM</span> rag_images;

<span class="hljs-comment">-- Clear tracking tables</span>
<span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">FROM</span> rag_file_tracking;
<span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">FROM</span> rag_indexing_sessions;

<span class="hljs-comment">-- Reset sequences to start from 1</span>
<span class="hljs-keyword">ALTER</span> SEQUENCE rag_documents_id_seq RESTART <span class="hljs-keyword">WITH</span> <span class="hljs-number">1</span>;
<span class="hljs-keyword">ALTER</span> SEQUENCE rag_document_chunks_id_seq RESTART <span class="hljs-keyword">WITH</span> <span class="hljs-number">1</span>;
<span class="hljs-keyword">ALTER</span> SEQUENCE rag_document_embeddings_id_seq RESTART <span class="hljs-keyword">WITH</span> <span class="hljs-number">1</span>;
<span class="hljs-keyword">ALTER</span> SEQUENCE rag_code_files_id_seq RESTART <span class="hljs-keyword">WITH</span> <span class="hljs-number">1</span>;
<span class="hljs-keyword">ALTER</span> SEQUENCE rag_code_chunks_id_seq RESTART <span class="hljs-keyword">WITH</span> <span class="hljs-number">1</span>;
<span class="hljs-keyword">ALTER</span> SEQUENCE rag_code_embeddings_id_seq RESTART <span class="hljs-keyword">WITH</span> <span class="hljs-number">1</span>;
<span class="hljs-keyword">ALTER</span> SEQUENCE rag_captions_id_seq RESTART <span class="hljs-keyword">WITH</span> <span class="hljs-number">1</span>;
<span class="hljs-keyword">ALTER</span> SEQUENCE rag_caption_embeddings_id_seq RESTART <span class="hljs-keyword">WITH</span> <span class="hljs-number">1</span>;
<span class="hljs-keyword">ALTER</span> SEQUENCE rag_images_id_seq RESTART <span class="hljs-keyword">WITH</span> <span class="hljs-number">1</span>;
<span class="hljs-keyword">ALTER</span> SEQUENCE rag_image_embeddings_id_seq RESTART <span class="hljs-keyword">WITH</span> <span class="hljs-number">1</span>;
<span class="hljs-keyword">ALTER</span> SEQUENCE rag_file_tracking_id_seq RESTART <span class="hljs-keyword">WITH</span> <span class="hljs-number">1</span>;
<span class="hljs-keyword">ALTER</span> SEQUENCE rag_indexing_sessions_id_seq RESTART <span class="hljs-keyword">WITH</span> <span class="hljs-number">1</span>;</code></pre><h2>What Gets Cleared</h2>
<p>The following data is removed:</p>
<ul>
<li><strong>Documents</strong>: All ingested text documents and their chunks</li>
<li><strong>Code</strong>: All code files and their chunks</li>
<li><strong>Captions</strong>: All image captions</li>
<li><strong>Images</strong>: All image metadata and CLIP embeddings</li>
<li><strong>Embeddings</strong>: All vector embeddings for text, code, captions, and images</li>
<li><strong>File Tracking</strong>: All file modification tracking data</li>
<li><strong>Indexing Sessions</strong>: All indexing session history</li>
</ul>
<h2>What Gets Preserved</h2>
<p>The following database structure remains intact:</p>
<ul>
<li>All table schemas and columns</li>
<li>All indexes (including HNSW vector indexes)</li>
<li>All triggers and functions</li>
<li>All foreign key constraints</li>
<li>All sequences (though they are reset to start from 1)</li>
</ul>
<h2>After Clearing Data</h2>
<p>Once you&#39;ve cleared the data:</p>
<ol>
<li><strong>Re-enable indexing</strong> if you want to start fresh indexing</li>
<li><strong>Re-ingest documents</strong> using the RAG ingestion endpoints</li>
<li><strong>Monitor the indexing process</strong> through the RAG settings interface</li>
</ol>
<h2>Safety Considerations</h2>
<ul>
<li><strong>Backup first</strong>: Consider backing up your database before clearing data</li>
<li><strong>Confirm action</strong>: The web interface requires confirmation before clearing</li>
<li><strong>Admin only</strong>: Only admin users can clear RAG data</li>
<li><strong>Irreversible</strong>: This action cannot be undone</li>
</ul>
<h2>Troubleshooting</h2>
<p>If you encounter issues:</p>
<ol>
<li><strong>Check permissions</strong>: Ensure you have admin access</li>
<li><strong>Verify database connection</strong>: Make sure the PostgreSQL connection is<br>working</li>
<li><strong>Check logs</strong>: Look for error messages in the application logs</li>
<li><strong>Restart services</strong>: If needed, restart the RAG services</li>
</ol>
<h2>Related Documentation</h2>
<ul>
<li><a href="rag-ops.md">RAG Operations Guide</a> - General RAG operations and maintenance</li>
<li><a href="embeddings-and-vector-db.md">Embeddings and Vector DB</a> - Technical details<br>about the vector database</li>
<li><a href="rag-demo-flows.md">RAG Demo Flows</a> - Example usage patterns</li>
</ul>
</div>
    </div>
  </main>
  <footer class="docs-footer"><p>&copy; 2024 Reynard Documentation Test. Built with ❤️ using SolidJS.</p></footer>
</body>
</html>