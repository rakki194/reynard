<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Reynard Annotating - Reynard Documentation Test</title>
  <link rel="stylesheet" href="../styles.css">
  <link rel="stylesheet" href="../highlight.css">
  <link rel="icon" href="/favicon.ico">
</head>
<body>
  <nav class="docs-nav">
    <div class="nav-brand"><a href="../index.html">Reynard Documentation Test</a></div>
    <div class="nav-links"><a href="../index.html">Home</a><a href="../api.html">API Reference</a></div>
  </nav>
  <main class="docs-main">
    <div class="docs-content">
      <h1>Reynard Annotating</h1>
      <div class="markdown-content"><h1>Reynard Annotating</h1>
<p>Unified annotation system for Reynard with production features and modular architecture. This package integrates all caption generators into a single, easy-to-use interface.</p>
<h2>Features</h2>
<ul>
<li><strong>Backend Integration</strong>: Interfaces with FastAPI backend for caption generation</li>
<li><strong>Simplified Architecture</strong>: No complex local model management</li>
<li><strong>Type Safety</strong>: Full TypeScript support with comprehensive types</li>
<li><strong>Event System</strong>: Real-time event handling for caption lifecycle</li>
<li><strong>Configuration Packages</strong>: Individual packages for generator configurations</li>
<li><strong>Easy Migration</strong>: Simple migration from legacy local mode</li>
</ul>
<h2>Installation</h2>
<pre><code class="hljs language-bash">npm install reynard-annotating</code></pre><h2>Quick Start</h2>
<h3>Backend Mode (Recommended)</h3>
<pre><code class="hljs language-typescript"><span class="hljs-keyword">import</span> {
  createBackendAnnotationManager,
  <span class="hljs-variable constant_">DEFAULT_BACKEND_CONFIG</span>,
  <span class="hljs-keyword">type</span> <span class="hljs-title class_">CaptionTask</span>,
} <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;reynard-annotating&quot;</span>;

<span class="hljs-comment">// Create backend manager that interfaces with FastAPI backend</span>
<span class="hljs-keyword">const</span> manager = <span class="hljs-title function_">createBackendAnnotationManager</span>({
  ...<span class="hljs-variable constant_">DEFAULT_BACKEND_CONFIG</span>,
  <span class="hljs-attr">baseUrl</span>: <span class="hljs-string">&quot;http://localhost:8000&quot;</span>, <span class="hljs-comment">// Your FastAPI backend URL</span>
});

<span class="hljs-comment">// Initialize connection to backend</span>
<span class="hljs-keyword">await</span> manager.<span class="hljs-title function_">initialize</span>();

<span class="hljs-comment">// Generate captions using different generators</span>
<span class="hljs-keyword">const</span> furryTags = <span class="hljs-keyword">await</span> manager.<span class="hljs-title function_">generateFurryTags</span>(<span class="hljs-string">&quot;/path/to/image.jpg&quot;</span>);
<span class="hljs-keyword">const</span> detailedCaption =
  <span class="hljs-keyword">await</span> manager.<span class="hljs-title function_">generateDetailedCaption</span>(<span class="hljs-string">&quot;/path/to/image.jpg&quot;</span>);
<span class="hljs-keyword">const</span> animeTags = <span class="hljs-keyword">await</span> manager.<span class="hljs-title function_">generateAnimeTags</span>(<span class="hljs-string">&quot;/path/to/image.jpg&quot;</span>);

<span class="hljs-comment">// Or use the service directly</span>
<span class="hljs-keyword">const</span> service = manager.<span class="hljs-title function_">getService</span>();
<span class="hljs-keyword">const</span> <span class="hljs-attr">task</span>: <span class="hljs-title class_">CaptionTask</span> = {
  <span class="hljs-attr">imagePath</span>: <span class="hljs-string">&quot;/path/to/image.jpg&quot;</span>,
  <span class="hljs-attr">generatorName</span>: <span class="hljs-string">&quot;jtp2&quot;</span>,
  <span class="hljs-attr">config</span>: { <span class="hljs-attr">threshold</span>: <span class="hljs-number">0.2</span> },
};

<span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> service.<span class="hljs-title function_">generateCaption</span>(task);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;Generated caption:&quot;</span>, result.<span class="hljs-property">caption</span>);

<span class="hljs-comment">// Monitor system health</span>
<span class="hljs-keyword">const</span> health = manager.<span class="hljs-title function_">getHealthStatus</span>();
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;System healthy:&quot;</span>, health.<span class="hljs-property">isHealthy</span>);

<span class="hljs-comment">// Cleanup</span>
<span class="hljs-keyword">await</span> manager.<span class="hljs-title function_">shutdown</span>();</code></pre><h2>Architecture</h2>
<p>The Reynard Annotating system now uses a clean backend-integrated architecture:</p>
<pre><code class="hljs">reynard-annotating<span class="hljs-symbol">/</span>
├── annotating-core<span class="hljs-symbol">/</span>          <span class="hljs-comment"># Core functionality and FastAPI client</span>
│   ├── clients<span class="hljs-symbol">/</span>             <span class="hljs-comment"># FastAPI client for backend communication</span>
│   ├── services<span class="hljs-symbol">/</span>            <span class="hljs-comment"># Backend annotation services</span>
│   ├── types<span class="hljs-symbol">/</span>               <span class="hljs-comment"># TypeScript definitions and interfaces</span>
│   └── utils<span class="hljs-symbol">/</span>               <span class="hljs-comment"># Shared utilities</span>
├── annotating-jtp2<span class="hljs-symbol">/</span>          <span class="hljs-comment"># JTP2 configuration package</span>
│   └── config<span class="hljs-symbol">/</span>              <span class="hljs-comment"># Configuration schemas and defaults</span>
├── annotating-joy<span class="hljs-symbol">/</span>           <span class="hljs-comment"># JoyCaption configuration package</span>
│   └── config<span class="hljs-symbol">/</span>              <span class="hljs-comment"># Configuration schemas and defaults</span>
├── annotating-florence2<span class="hljs-symbol">/</span>     <span class="hljs-comment"># Florence2 configuration package</span>
│   └── config<span class="hljs-symbol">/</span>              <span class="hljs-comment"># Configuration schemas and defaults</span>
├── annotating-wdv3<span class="hljs-symbol">/</span>          <span class="hljs-comment"># WDv3 configuration package</span>
│   └── config<span class="hljs-symbol">/</span>              <span class="hljs-comment"># Configuration schemas and defaults</span>
└── annotating<span class="hljs-symbol">/</span>               <span class="hljs-comment"># Unified interface (this package)</span>
    ├── BackendAnnotationManager.ts  <span class="hljs-comment"># Main backend manager</span>
    └── MIGRATION.md          <span class="hljs-comment"># Migration guide from legacy system</span></code></pre><h2>Available Generators</h2>
<h3>JTP2 (Joint Tagger Project PILOT2)</h3>
<ul>
<li><strong>Purpose</strong>: Furry artwork tagging</li>
<li><strong>Category</strong>: Lightweight</li>
<li><strong>Specialization</strong>: High accuracy for furry content</li>
<li><strong>Usage</strong>: <code>manager.generateFurryTags(imagePath)</code></li>
</ul>
<h3>JoyCaption</h3>
<ul>
<li><strong>Purpose</strong>: Detailed image captioning</li>
<li><strong>Category</strong>: Heavy</li>
<li><strong>Specialization</strong>: Multilingual, detailed descriptions</li>
<li><strong>Usage</strong>: <code>manager.generateDetailedCaption(imagePath)</code></li>
</ul>
<h3>Florence2</h3>
<ul>
<li><strong>Purpose</strong>: General purpose captioning</li>
<li><strong>Category</strong>: Heavy</li>
<li><strong>Specialization</strong>: Multiple tasks, versatile</li>
<li><strong>Usage</strong>: <code>manager.generateGeneralCaption(imagePath)</code></li>
</ul>
<h3>WDv3 (Waifu Diffusion v3)</h3>
<ul>
<li><strong>Purpose</strong>: Anime/manga tagging</li>
<li><strong>Category</strong>: Lightweight</li>
<li><strong>Specialization</strong>: Danbooru-style tags</li>
<li><strong>Usage</strong>: <code>manager.generateAnimeTags(imagePath)</code></li>
</ul>
<h2>Production Features</h2>
<h3>Usage Tracking</h3>
<pre><code class="hljs language-typescript"><span class="hljs-comment">// Get usage statistics for any model</span>
<span class="hljs-keyword">const</span> stats = manager.<span class="hljs-title function_">getModelUsageStats</span>(<span class="hljs-string">&quot;jtp2&quot;</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;Total requests:&quot;</span>, stats?.<span class="hljs-property">totalRequests</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;Success rate:&quot;</span>, stats?.<span class="hljs-property">successfulRequests</span> / stats?.<span class="hljs-property">totalRequests</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;Average processing time:&quot;</span>, stats?.<span class="hljs-property">averageProcessingTime</span>);</code></pre><h3>Health Monitoring</h3>
<pre><code class="hljs language-typescript"><span class="hljs-comment">// Get system health</span>
<span class="hljs-keyword">const</span> health = manager.<span class="hljs-title function_">getHealthStatus</span>();
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;System healthy:&quot;</span>, health.<span class="hljs-property">isHealthy</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;Performance metrics:&quot;</span>, health.<span class="hljs-property">performance</span>);

<span class="hljs-comment">// Get model-specific health</span>
<span class="hljs-keyword">const</span> modelHealth = manager.<span class="hljs-title function_">getModelManager</span>().<span class="hljs-title function_">getHealthStatus</span>(<span class="hljs-string">&quot;jtp2&quot;</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;Model healthy:&quot;</span>, modelHealth?.<span class="hljs-property">isHealthy</span>);</code></pre><h3>Event System</h3>
<pre><code class="hljs language-typescript"><span class="hljs-comment">// Listen to all annotation events</span>
manager.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {
  <span class="hljs-keyword">switch</span> (event.<span class="hljs-property">type</span>) {
    <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;model_loaded&quot;</span>:
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;Model loaded:&quot;</span>, event.<span class="hljs-property">data</span>.<span class="hljs-property">modelName</span>);
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;caption_completed&quot;</span>:
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;Caption generated:&quot;</span>, event.<span class="hljs-property">data</span>.<span class="hljs-property">result</span>.<span class="hljs-property">caption</span>);
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;batch_progress&quot;</span>:
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;Batch progress:&quot;</span>, event.<span class="hljs-property">data</span>.<span class="hljs-property">progress</span> + <span class="hljs-string">&quot;%&quot;</span>);
      <span class="hljs-keyword">break</span>;
  }
});</code></pre><h3>System Statistics</h3>
<pre><code class="hljs language-typescript"><span class="hljs-comment">// Get comprehensive system statistics</span>
<span class="hljs-keyword">const</span> stats = manager.<span class="hljs-title function_">getSystemStatistics</span>();
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;Total processed:&quot;</span>, stats.<span class="hljs-property">totalProcessed</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;Loaded models:&quot;</span>, stats.<span class="hljs-property">loadedModels</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;Queue status:&quot;</span>, stats.<span class="hljs-property">queueStatus</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;Health status:&quot;</span>, stats.<span class="hljs-property">healthStatus</span>);</code></pre><h2>Configuration</h2>
<pre><code class="hljs language-typescript"><span class="hljs-keyword">const</span> config = {
  <span class="hljs-attr">maxConcurrentDownloads</span>: <span class="hljs-number">2</span>, <span class="hljs-comment">// Max concurrent model downloads</span>
  <span class="hljs-attr">maxConcurrentLoads</span>: <span class="hljs-number">4</span>, <span class="hljs-comment">// Max concurrent model loads</span>
  <span class="hljs-attr">downloadTimeout</span>: <span class="hljs-number">300000</span>, <span class="hljs-comment">// Download timeout (5 minutes)</span>
  <span class="hljs-attr">loadTimeout</span>: <span class="hljs-number">60000</span>, <span class="hljs-comment">// Load timeout (1 minute)</span>
  <span class="hljs-attr">autoUnloadDelay</span>: <span class="hljs-number">300000</span>, <span class="hljs-comment">// Auto-unload delay (5 minutes)</span>
  <span class="hljs-attr">healthCheckInterval</span>: <span class="hljs-number">30000</span>, <span class="hljs-comment">// Health check interval (30 seconds)</span>
  <span class="hljs-attr">usageTrackingEnabled</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// Enable usage tracking</span>
  <span class="hljs-attr">preloadEnabled</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// Enable model preloading</span>
  <span class="hljs-attr">preloadModels</span>: [<span class="hljs-string">&quot;jtp2&quot;</span>, <span class="hljs-string">&quot;wdv3&quot;</span>], <span class="hljs-comment">// Models to preload</span>
};

<span class="hljs-keyword">const</span> manager = <span class="hljs-title function_">createUnifiedAnnotationManager</span>(config);</code></pre><h2>Advanced Usage</h2>
<h3>Custom Generator Integration</h3>
<pre><code class="hljs language-typescript"><span class="hljs-keyword">import</span> { registerJTP2Plugin } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;reynard-annotating-jtp2&quot;</span>;

<span class="hljs-comment">// Get specific generator</span>
<span class="hljs-keyword">const</span> jtp2Generator = <span class="hljs-keyword">await</span> manager.<span class="hljs-title function_">getJTP2Generator</span>();
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;JTP2 features:&quot;</span>, jtp2Generator?.<span class="hljs-property">features</span>);

<span class="hljs-comment">// Use generator directly</span>
<span class="hljs-keyword">if</span> (jtp2Generator) {
  <span class="hljs-keyword">await</span> jtp2Generator.<span class="hljs-title function_">load</span>();
  <span class="hljs-keyword">const</span> caption = <span class="hljs-keyword">await</span> jtp2Generator.<span class="hljs-title function_">generate</span>(<span class="hljs-string">&quot;/path/to/image.jpg&quot;</span>);
  <span class="hljs-keyword">await</span> jtp2Generator.<span class="hljs-title function_">unload</span>();
}</code></pre><h3>Batch Processing</h3>
<pre><code class="hljs language-typescript"><span class="hljs-keyword">const</span> tasks = [
  { <span class="hljs-attr">imagePath</span>: <span class="hljs-string">&quot;/path/to/image1.jpg&quot;</span>, <span class="hljs-attr">generatorName</span>: <span class="hljs-string">&quot;jtp2&quot;</span> },
  { <span class="hljs-attr">imagePath</span>: <span class="hljs-string">&quot;/path/to/image2.jpg&quot;</span>, <span class="hljs-attr">generatorName</span>: <span class="hljs-string">&quot;joycaption&quot;</span> },
  { <span class="hljs-attr">imagePath</span>: <span class="hljs-string">&quot;/path/to/image3.jpg&quot;</span>, <span class="hljs-attr">generatorName</span>: <span class="hljs-string">&quot;wdv3&quot;</span> },
];

<span class="hljs-keyword">const</span> results = <span class="hljs-keyword">await</span> service.<span class="hljs-title function_">generateBatchCaptions</span>(tasks, <span class="hljs-function">(<span class="hljs-params">progress</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(
    <span class="hljs-string">`Progress: <span class="hljs-subst">${progress.progress}</span>% (<span class="hljs-subst">${progress.completed}</span>/<span class="hljs-subst">${progress.total}</span>)`</span>,
  );
});</code></pre><h3>Model Management</h3>
<pre><code class="hljs language-typescript"><span class="hljs-comment">// Preload specific models</span>
<span class="hljs-keyword">await</span> manager.<span class="hljs-title function_">preloadModel</span>(<span class="hljs-string">&quot;jtp2&quot;</span>);
<span class="hljs-keyword">await</span> manager.<span class="hljs-title function_">preloadModel</span>(<span class="hljs-string">&quot;joycaption&quot;</span>);

<span class="hljs-comment">// Check if models are loaded</span>
<span class="hljs-keyword">const</span> loadedModels = manager.<span class="hljs-title function_">getModelManager</span>().<span class="hljs-title function_">getLoadedModels</span>();
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;Loaded models:&quot;</span>, loadedModels);

<span class="hljs-comment">// Unload models when done</span>
<span class="hljs-keyword">await</span> manager.<span class="hljs-title function_">unloadModel</span>(<span class="hljs-string">&quot;jtp2&quot;</span>);</code></pre><h2>API Reference</h2>
<h3>UnifiedAnnotationManager</h3>
<p>Main entry point for the unified annotation system.</p>
<h4>Methods</h4>
<ul>
<li><code>initialize()</code>: Initialize the manager with all generators</li>
<li><code>shutdown()</code>: Shutdown the manager and cleanup resources</li>
<li><code>getService()</code>: Get the annotation service</li>
<li><code>getAvailableGenerators()</code>: Get all available generators</li>
<li><code>isGeneratorAvailable(name)</code>: Check if a generator is available</li>
<li><code>preloadModel(name)</code>: Preload a specific model</li>
<li><code>unloadModel(name)</code>: Unload a specific model</li>
<li><code>getModelUsageStats(name)</code>: Get usage statistics for a model</li>
<li><code>getHealthStatus()</code>: Get system health status</li>
<li><code>getConfiguration()</code>: Get current configuration</li>
<li><code>updateConfiguration(config)</code>: Update configuration</li>
<li><code>getSystemStatistics()</code>: Get comprehensive system statistics</li>
<li><code>addEventListener(listener)</code>: Add event listener</li>
<li><code>removeEventListener(listener)</code>: Remove event listener</li>
</ul>
<h4>Convenience Methods</h4>
<ul>
<li><code>generateFurryTags(imagePath, config?)</code>: Generate furry tags using JTP2</li>
<li><code>generateDetailedCaption(imagePath, config?)</code>: Generate detailed caption using JoyCaption</li>
<li><code>generateAnimeTags(imagePath, config?)</code>: Generate anime tags using WDv3</li>
<li><code>generateGeneralCaption(imagePath, config?)</code>: Generate general caption using Florence2</li>
<li><code>getJTP2Generator()</code>: Get JTP2 generator instance</li>
<li><code>getJoyCaptionGenerator()</code>: Get JoyCaption generator instance</li>
<li><code>getFlorence2Generator()</code>: Get Florence2 generator instance</li>
<li><code>getWDv3Generator()</code>: Get WDv3 generator instance</li>
</ul>
<h3>Package Dependencies</h3>
<ul>
<li><strong>annotating-core</strong>: Base package with FastAPI client and shared utilities</li>
<li><strong>annotating-{generator}</strong>: Each generator package provides only configuration schemas</li>
<li><strong>annotating</strong>: Main package that provides the BackendAnnotationManager</li>
</ul>
<h3>Key Architectural Principles</h3>
<ol>
<li><strong>Backend Integration</strong>: All actual model processing happens on the FastAPI backend</li>
<li><strong>Configuration Only</strong>: Frontend packages only provide configuration schemas</li>
<li><strong>Clean Separation</strong>: Clear separation between frontend configuration and backend processing</li>
<li><strong>Production Features</strong>: Built-in health monitoring, circuit breakers, and usage tracking</li>
<li><strong>Type Safety</strong>: Full TypeScript support with comprehensive type definitions</li>
<li><strong>Event-Driven</strong>: Comprehensive event system for monitoring and debugging</li>
</ol>
<h2>License</h2>
<p>MIT</p>
</div>
    </div>
  </main>
  <footer class="docs-footer"><p>&copy; 2024 Reynard Documentation Test. Built with ❤️ using SolidJS.</p></footer>
</body>
</html>