<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Annotator - Reynard Documentation Test</title>
  <link rel="stylesheet" href="../styles.css">
  <link rel="stylesheet" href="../highlight.css">
  <link rel="icon" href="/favicon.ico">
</head>
<body>
  <nav class="docs-nav">
    <div class="nav-brand"><a href="../index.html">Reynard Documentation Test</a></div>
    <div class="nav-links"><a href="../index.html">Home</a><a href="../api.html">API Reference</a></div>
  </nav>
  <main class="docs-main">
    <div class="docs-content">
      <h1>Annotator</h1>
      <div class="markdown-content"><h1>Annotator</h1>
<p>A comprehensive image captioning and tagging toolkit that provides unified APIs for various captioning and tagging models.</p>
<h2>Features</h2>
<ul>
<li><strong>Multiple Captioning Models</strong>: Support for Florence2, JoyCaption, and other captioning systems</li>
<li><strong>Tagging Systems</strong>: WDV3, JTP2, and other tagging models</li>
<li><strong>Unified API</strong>: Consistent interface across different models</li>
<li><strong>Model Management</strong>: Smart loading and caching of models</li>
<li><strong>Batch Processing</strong>: Efficient batch operations for large datasets</li>
<li><strong>Extensible</strong>: Plugin system for adding new models</li>
</ul>
<h2>Installation</h2>
<pre><code class="hljs language-bash">pip install annotator</code></pre><p>For development installation:</p>
<pre><code class="hljs language-bash">git <span class="hljs-built_in">clone</span> &lt;repository-url&gt;
<span class="hljs-built_in">cd</span> annotator
pip install -e <span class="hljs-string">&quot;.[dev]&quot;</span></code></pre><h2>Quick Start</h2>
<h3>Basic Usage</h3>
<pre><code class="hljs language-python"><span class="hljs-keyword">from</span> annotator <span class="hljs-keyword">import</span> Annotator
<span class="hljs-keyword">from</span> PIL <span class="hljs-keyword">import</span> Image

<span class="hljs-comment"># Initialize the annotator</span>
annotator = Annotator()

<span class="hljs-comment"># Load an image</span>
image = Image.<span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;path/to/image.jpg&quot;</span>)

<span class="hljs-comment"># Generate a caption</span>
caption = annotator.caption_image(image, model=<span class="hljs-string">&quot;florence2&quot;</span>)

<span class="hljs-comment"># Generate tags</span>
tags = annotator.tag_image(image, model=<span class="hljs-string">&quot;wdv3&quot;</span>)

<span class="hljs-comment"># Combine captioning and tagging</span>
result = annotator.annotate_image(image, caption_model=<span class="hljs-string">&quot;florence2&quot;</span>, tag_model=<span class="hljs-string">&quot;wdv3&quot;</span>)</code></pre><h3>Available Models</h3>
<h4>Captioning Models</h4>
<ul>
<li><code>florence2</code>: Florence2-large model for detailed captions</li>
<li><code>joycaption</code>: JoyCaption model for various caption styles</li>
<li><code>jtp2</code>: JTP2 model for specialized captioning</li>
</ul>
<h4>Tagging Models</h4>
<ul>
<li><code>wdv3</code>: WaifuDiffusion Tagger v3 for general tagging</li>
<li><code>jtp2</code>: Joint Tagger Project 2 for specialized tagging</li>
</ul>
<h2>API Reference</h2>
<h3>Annotator Class</h3>
<p>The main class for image annotation operations.</p>
<pre><code class="hljs language-python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Annotator</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, cache_dir: <span class="hljs-type">Optional</span>[<span class="hljs-built_in">str</span>] = <span class="hljs-literal">None</span></span>):
        <span class="hljs-string">&quot;&quot;&quot;Initialize the annotator with optional cache directory.&quot;&quot;&quot;</span>
        
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">caption_image</span>(<span class="hljs-params">
        self, 
        image: Image.Image, 
        model: <span class="hljs-built_in">str</span> = <span class="hljs-string">&quot;florence2&quot;</span>,
        **kwargs
    </span>) -&gt; <span class="hljs-built_in">str</span>:
        <span class="hljs-string">&quot;&quot;&quot;Generate a caption for an image.&quot;&quot;&quot;</span>
        
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">tag_image</span>(<span class="hljs-params">
        self, 
        image: Image.Image, 
        model: <span class="hljs-built_in">str</span> = <span class="hljs-string">&quot;wdv3&quot;</span>,
        **kwargs
    </span>) -&gt; <span class="hljs-type">List</span>[<span class="hljs-built_in">str</span>]:
        <span class="hljs-string">&quot;&quot;&quot;Generate tags for an image.&quot;&quot;&quot;</span>
        
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">annotate_image</span>(<span class="hljs-params">
        self,
        image: Image.Image,
        caption_model: <span class="hljs-built_in">str</span> = <span class="hljs-string">&quot;florence2&quot;</span>,
        tag_model: <span class="hljs-built_in">str</span> = <span class="hljs-string">&quot;wdv3&quot;</span>,
        **kwargs
    </span>) -&gt; <span class="hljs-type">Dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-type">Any</span>]:
        <span class="hljs-string">&quot;&quot;&quot;Generate both caption and tags for an image.&quot;&quot;&quot;</span></code></pre><h3>Model Configuration</h3>
<p>Each model can be configured with specific parameters:</p>
<pre><code class="hljs language-python"><span class="hljs-comment"># Configure Florence2</span>
florence_config = {
    <span class="hljs-string">&quot;expected_caption_length&quot;</span>: <span class="hljs-number">100</span>,
    <span class="hljs-string">&quot;temperature&quot;</span>: <span class="hljs-number">0.7</span>,
    <span class="hljs-string">&quot;max_new_tokens&quot;</span>: <span class="hljs-number">512</span>
}

<span class="hljs-comment"># Configure WDV3</span>
wdv3_config = {
    <span class="hljs-string">&quot;gen_threshold&quot;</span>: <span class="hljs-number">0.35</span>,
    <span class="hljs-string">&quot;char_threshold&quot;</span>: <span class="hljs-number">0.75</span>,
    <span class="hljs-string">&quot;model&quot;</span>: <span class="hljs-string">&quot;vit&quot;</span>
}

<span class="hljs-comment"># Use configurations</span>
caption = annotator.caption_image(image, model=<span class="hljs-string">&quot;florence2&quot;</span>, **florence_config)
tags = annotator.tag_image(image, model=<span class="hljs-string">&quot;wdv3&quot;</span>, **wdv3_config)</code></pre><h2>Advanced Usage</h2>
<h3>Batch Processing</h3>
<pre><code class="hljs language-python"><span class="hljs-keyword">from</span> pathlib <span class="hljs-keyword">import</span> Path

<span class="hljs-comment"># Process a directory of images</span>
image_dir = Path(<span class="hljs-string">&quot;path/to/images&quot;</span>)
results = annotator.batch_annotate(
    image_dir, 
    caption_model=<span class="hljs-string">&quot;florence2&quot;</span>,
    tag_model=<span class="hljs-string">&quot;wdv3&quot;</span>
)</code></pre><h3>Custom Model Loading</h3>
<pre><code class="hljs language-python"><span class="hljs-comment"># Load specific models</span>
annotator.load_model(<span class="hljs-string">&quot;florence2&quot;</span>)
annotator.load_model(<span class="hljs-string">&quot;wdv3&quot;</span>)

<span class="hljs-comment"># Check loaded models</span>
loaded_models = annotator.get_loaded_models()</code></pre><h3>Error Handling</h3>
<pre><code class="hljs language-python"><span class="hljs-keyword">from</span> annotator <span class="hljs-keyword">import</span> CaptionError, ModelLoadingError

<span class="hljs-keyword">try</span>:
    caption = annotator.caption_image(image, model=<span class="hljs-string">&quot;florence2&quot;</span>)
<span class="hljs-keyword">except</span> ModelLoadingError <span class="hljs-keyword">as</span> e:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Model loading failed: <span class="hljs-subst">{e}</span>&quot;</span>)
<span class="hljs-keyword">except</span> CaptionError <span class="hljs-keyword">as</span> e:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Caption generation failed: <span class="hljs-subst">{e}</span>&quot;</span>)</code></pre><h2>Development</h2>
<h3>Running Tests</h3>
<pre><code class="hljs language-bash">pytest</code></pre><h3>Code Formatting</h3>
<pre><code class="hljs language-bash">black annotator/
isort annotator/</code></pre><h3>Type Checking</h3>
<pre><code class="hljs language-bash">mypy annotator/</code></pre><h2>Contributing</h2>
<ol>
<li>Fork the repository</li>
<li>Create a feature branch</li>
<li>Make your changes</li>
<li>Add tests for new functionality</li>
<li>Run the test suite</li>
<li>Submit a pull request</li>
</ol>
<h2>License</h2>
<p>MIT License - see LICENSE file for details.</p>
<h2>Acknowledgments</h2>
<ul>
<li>Florence2 model by Microsoft</li>
<li>JoyCaption model by the JoyCaption team</li>
<li>WDV3 tagger by SmilingWolf</li>
<li>JTP2 by RedRocket</li>
</ul>
</div>
    </div>
  </main>
  <footer class="docs-footer"><p>&copy; 2024 Reynard Documentation Test. Built with ❤️ using SolidJS.</p></footer>
</body>
</html>