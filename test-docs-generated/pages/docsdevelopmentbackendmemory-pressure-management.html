<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Memory Pressure Management - Reynard Documentation Test</title>
  <link rel="stylesheet" href="../styles.css">
  <link rel="stylesheet" href="../highlight.css">
  <link rel="icon" href="/favicon.ico">
</head>
<body>
  <nav class="docs-nav">
    <div class="nav-brand"><a href="../index.html">Reynard Documentation Test</a></div>
    <div class="nav-links"><a href="../index.html">Home</a><a href="../api.html">API Reference</a></div>
  </nav>
  <main class="docs-main">
    <div class="docs-content">
      <h1>Memory Pressure Management</h1>
      <div class="markdown-content"><h1>Memory Pressure Management</h1>
<p>This document describes the enhanced memory pressure management system that provides comprehensive monitoring, alerting, and automatic optimization of memory usage in the lazy loading system.</p>
<h2>Overview</h2>
<p>The memory pressure management system monitors system memory usage in real-time and automatically takes action to prevent memory exhaustion. It includes:</p>
<ul>
<li><strong>System Memory Monitoring</strong>: Real-time monitoring of RAM and swap usage</li>
<li><strong>Memory Pressure Alerts</strong>: Configurable alerts based on memory usage thresholds</li>
<li><strong>Automatic Package Unloading</strong>: Intelligent unloading of packages under memory pressure</li>
<li><strong>Memory Optimization Suggestions</strong>: Proactive recommendations for memory optimization</li>
</ul>
<h2>System Memory Monitoring</h2>
<h3>MemoryMonitor Class</h3>
<p>The <code>MemoryMonitor</code> class provides comprehensive system memory monitoring capabilities:</p>
<pre><code class="hljs language-python"><span class="hljs-keyword">from</span> app.utils.lazy_loader <span class="hljs-keyword">import</span> MemoryMonitor

monitor = MemoryMonitor()

<span class="hljs-comment"># Get comprehensive system memory information</span>
system_info = monitor.get_system_memory_info()
<span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Memory usage: <span class="hljs-subst">{system_info[<span class="hljs-string">&#x27;percent&#x27;</span>]:<span class="hljs-number">.1</span>f}</span>%&quot;</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Swap usage: <span class="hljs-subst">{system_info[<span class="hljs-string">&#x27;swap_percent&#x27;</span>]:<span class="hljs-number">.1</span>f}</span>%&quot;</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Available memory: <span class="hljs-subst">{system_info[<span class="hljs-string">&#x27;available&#x27;</span>] / (<span class="hljs-number">1024</span>**<span class="hljs-number">3</span>):<span class="hljs-number">.1</span>f}</span>GB&quot;</span>)</code></pre><h3>System Memory Information</h3>
<p>The <code>get_system_memory_info()</code> method returns detailed memory information:</p>
<pre><code class="hljs language-python">{
    <span class="hljs-string">&quot;total&quot;</span>: <span class="hljs-number">8589934592</span>,           <span class="hljs-comment"># Total RAM in bytes</span>
    <span class="hljs-string">&quot;available&quot;</span>: <span class="hljs-number">2147483648</span>,       <span class="hljs-comment"># Available RAM in bytes</span>
    <span class="hljs-string">&quot;used&quot;</span>: <span class="hljs-number">6442450944</span>,            <span class="hljs-comment"># Used RAM in bytes</span>
    <span class="hljs-string">&quot;percent&quot;</span>: <span class="hljs-number">75.0</span>,               <span class="hljs-comment"># Memory usage percentage</span>
    <span class="hljs-string">&quot;swap_total&quot;</span>: <span class="hljs-number">2147483648</span>,      <span class="hljs-comment"># Total swap in bytes</span>
    <span class="hljs-string">&quot;swap_used&quot;</span>: <span class="hljs-number">1073741824</span>,       <span class="hljs-comment"># Used swap in bytes</span>
    <span class="hljs-string">&quot;swap_percent&quot;</span>: <span class="hljs-number">50.0</span>,          <span class="hljs-comment"># Swap usage percentage</span>
    <span class="hljs-string">&quot;swap_available&quot;</span>: <span class="hljs-number">1073741824</span>,  <span class="hljs-comment"># Available swap in bytes</span>
    <span class="hljs-string">&quot;memory_pressure_level&quot;</span>: <span class="hljs-string">&quot;medium&quot;</span>,  <span class="hljs-comment"># Current pressure level</span>
    <span class="hljs-string">&quot;timestamp&quot;</span>: <span class="hljs-number">1703123456.789</span>    <span class="hljs-comment"># Timestamp of measurement</span>
}</code></pre><h2>Memory Pressure Levels</h2>
<p>The system defines four memory pressure levels:</p>
<ul>
<li><strong>Low</strong>: &lt; 50% memory usage</li>
<li><strong>Medium</strong>: 50-70% memory usage</li>
<li><strong>High</strong>: 70-85% memory usage</li>
<li><strong>Critical</strong>: &gt; 85% memory usage</li>
</ul>
<h3>Configurable Thresholds</h3>
<p>Memory pressure thresholds can be customized:</p>
<pre><code class="hljs language-python"><span class="hljs-keyword">from</span> app.utils.lazy_loader <span class="hljs-keyword">import</span> get_lazy_loader

loader = get_lazy_loader()

<span class="hljs-comment"># Set custom thresholds</span>
thresholds = {
    <span class="hljs-string">&quot;warning&quot;</span>: <span class="hljs-number">0.6</span>,        <span class="hljs-comment"># 60% - send warning</span>
    <span class="hljs-string">&quot;unload_packages&quot;</span>: <span class="hljs-number">0.8</span>, <span class="hljs-comment"># 80% - start unloading packages</span>
    <span class="hljs-string">&quot;aggressive_unload&quot;</span>: <span class="hljs-number">0.85</span>, <span class="hljs-comment"># 85% - aggressive unloading</span>
    <span class="hljs-string">&quot;emergency&quot;</span>: <span class="hljs-number">0.9</span>,      <span class="hljs-comment"># 90% - emergency measures</span>
}

loader.set_memory_pressure_thresholds(thresholds)</code></pre><h2>Memory Pressure Alerts</h2>
<h3>Alert System</h3>
<p>The system automatically generates alerts based on memory pressure conditions:</p>
<pre><code class="hljs language-python"><span class="hljs-keyword">from</span> app.utils.lazy_loader <span class="hljs-keyword">import</span> get_lazy_loader

loader = get_lazy_loader()

<span class="hljs-comment"># Get current memory pressure alerts</span>
alerts = loader.get_memory_pressure_alerts()

<span class="hljs-keyword">for</span> alert <span class="hljs-keyword">in</span> alerts:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Level: <span class="hljs-subst">{alert[<span class="hljs-string">&#x27;level&#x27;</span>]}</span>&quot;</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Message: <span class="hljs-subst">{alert[<span class="hljs-string">&#x27;message&#x27;</span>]}</span>&quot;</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Recommendation: <span class="hljs-subst">{alert[<span class="hljs-string">&#x27;recommendation&#x27;</span>]}</span>&quot;</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Action Required: <span class="hljs-subst">{alert[<span class="hljs-string">&#x27;action_required&#x27;</span>]}</span>&quot;</span>)</code></pre><h3>Alert Levels</h3>
<ul>
<li><strong>Warning</strong>: Memory usage approaching threshold</li>
<li><strong>Medium</strong>: Moderate memory pressure detected</li>
<li><strong>High</strong>: High memory pressure requiring action</li>
<li><strong>Emergency</strong>: Critical memory pressure requiring immediate action</li>
</ul>
<h3>Alert Cooldown</h3>
<p>Alerts include a cooldown period (default: 5 minutes) to prevent spam:</p>
<pre><code class="hljs language-python"><span class="hljs-keyword">from</span> app.utils.lazy_loader <span class="hljs-keyword">import</span> MemoryMonitor

monitor = MemoryMonitor()

<span class="hljs-comment"># Enable/disable alerts</span>
monitor.enable_memory_pressure_alerts(<span class="hljs-literal">True</span>)   <span class="hljs-comment"># Enable alerts</span>
monitor.enable_memory_pressure_alerts(<span class="hljs-literal">False</span>)  <span class="hljs-comment"># Disable alerts</span></code></pre><h2>Automatic Package Unloading</h2>
<h3>Enhanced Unloading Logic</h3>
<p>The system automatically unloads packages under memory pressure with different strategies:</p>
<h4>Critical Pressure (≥ 95% memory usage)</h4>
<ul>
<li>Unloads packages after 30 seconds of inactivity</li>
<li>Maximum priority for unloading</li>
<li>Overrides user preferences</li>
</ul>
<h4>High Pressure (≥ 85% memory usage)</h4>
<ul>
<li>Unloads packages after half the normal timeout</li>
<li>Increased unloading priority</li>
<li>Overrides user preferences</li>
</ul>
<h4>Medium/Low Pressure</h4>
<ul>
<li>Normal unloading behavior</li>
<li>Respects user preferences</li>
<li>Standard timeout periods</li>
</ul>
<h3>Adaptive Unloading</h3>
<p>The system adjusts unloading behavior based on memory pressure:</p>
<pre><code class="hljs language-python"><span class="hljs-comment"># Under normal pressure: max 5 packages per cycle</span>
<span class="hljs-comment"># Under high pressure: max 7-8 packages per cycle</span>
<span class="hljs-comment"># Under critical pressure: max 10 packages per cycle</span></code></pre><h2>Memory Optimization Suggestions</h2>
<h3>Intelligent Recommendations</h3>
<p>The system provides proactive memory optimization suggestions:</p>
<pre><code class="hljs language-python"><span class="hljs-keyword">from</span> app.utils.lazy_loader <span class="hljs-keyword">import</span> get_lazy_loader

loader = get_lazy_loader()

<span class="hljs-comment"># Get memory optimization suggestions</span>
suggestions = loader.get_memory_optimization_suggestions()

<span class="hljs-keyword">for</span> suggestion <span class="hljs-keyword">in</span> suggestions:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Type: <span class="hljs-subst">{suggestion[<span class="hljs-string">&#x27;type&#x27;</span>]}</span>&quot;</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Severity: <span class="hljs-subst">{suggestion[<span class="hljs-string">&#x27;severity&#x27;</span>]}</span>&quot;</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Message: <span class="hljs-subst">{suggestion[<span class="hljs-string">&#x27;message&#x27;</span>]}</span>&quot;</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Recommendation: <span class="hljs-subst">{suggestion[<span class="hljs-string">&#x27;recommendation&#x27;</span>]}</span>&quot;</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Priority: <span class="hljs-subst">{suggestion[<span class="hljs-string">&#x27;priority&#x27;</span>]}</span>&quot;</span>)</code></pre><h3>Suggestion Types</h3>
<h4>System-Level Suggestions</h4>
<ul>
<li><strong>emergency_memory_reduction</strong>: Critical memory usage requiring immediate action</li>
<li><strong>aggressive_package_unloading</strong>: High memory usage requiring aggressive unloading</li>
<li><strong>moderate_package_unloading</strong>: Moderate memory usage requiring package unloading</li>
<li><strong>swap_usage_high</strong>: High swap usage indicating memory pressure</li>
<li><strong>swap_usage_moderate</strong>: Moderate swap usage requiring monitoring</li>
<li><strong>memory_trend_increasing</strong>: Memory usage trending upward</li>
<li><strong>low_available_memory</strong>: Low available memory requiring action</li>
</ul>
<h4>Package-Level Suggestions</h4>
<ul>
<li><strong>high_memory_footprint</strong>: Packages with large memory footprints</li>
<li><strong>memory_leak</strong>: Packages showing signs of memory leaks</li>
<li><strong>increasing_memory_trend</strong>: Packages with increasing memory usage</li>
</ul>
<h3>Suggestion Priorities</h3>
<p>Suggestions are prioritized by severity:</p>
<ol>
<li><strong>Critical</strong>: Immediate action required</li>
<li><strong>High</strong>: Action required soon</li>
<li><strong>Medium</strong>: Consider action</li>
<li><strong>Low</strong>: Monitor and consider</li>
</ol>
<h2>API Endpoints</h2>
<h3>Memory Pressure Summary</h3>
<p><strong>GET</strong> <code>/api/packages/memory/pressure-summary</code></p>
<p>Returns comprehensive memory pressure information.</p>
<p><strong>Response:</strong></p>
<pre><code class="hljs language-json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">&quot;status&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;success&quot;</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;data&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">&quot;system_memory&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">&quot;total&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">8589934592</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">&quot;available&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2147483648</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">&quot;used&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">6442450944</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">&quot;percent&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">75.0</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">&quot;swap_total&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2147483648</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">&quot;swap_used&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1073741824</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">&quot;swap_percent&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">50.0</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">&quot;memory_pressure_level&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;medium&quot;</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">&quot;timestamp&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1703123456.789</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">&quot;current_alerts&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
      <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">&quot;level&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;medium&quot;</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">&quot;message&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Moderate memory pressure: 75.0% memory usage&quot;</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">&quot;usage_percent&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.75</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">&quot;timestamp&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1703123456.789</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">&quot;recommendation&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Consider unloading unused packages&quot;</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">&quot;action_required&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">&quot;optimization_suggestions&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
      <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;moderate_package_unloading&quot;</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">&quot;severity&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;medium&quot;</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">&quot;message&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Moderate memory usage detected&quot;</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">&quot;recommendation&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Consider unloading unused packages&quot;</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">&quot;value&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.75</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">&quot;priority&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">&quot;alert_history&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>...<span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">&quot;memory_trend&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;stable&quot;</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">&quot;last_check&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1703123456.789</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">&quot;alerts_enabled&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">&quot;suggestions_enabled&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span></code></pre><h3>Memory Pressure Alerts</h3>
<p><strong>GET</strong> <code>/api/packages/memory/pressure-alerts</code></p>
<p>Returns current memory pressure alerts.</p>
<p><strong>Response:</strong></p>
<pre><code class="hljs language-json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">&quot;status&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;success&quot;</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;data&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">&quot;alerts&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>...<span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">&quot;total_alerts&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">&quot;critical_alerts&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">&quot;high_alerts&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">&quot;medium_alerts&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">&quot;warning_alerts&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">&quot;check_time&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1703123456.789</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span></code></pre><h3>System Memory Information</h3>
<p><strong>GET</strong> <code>/api/packages/memory/system-info</code></p>
<p>Returns detailed system memory information.</p>
<p><strong>Response:</strong></p>
<pre><code class="hljs language-json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">&quot;status&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;success&quot;</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;data&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">&quot;total&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">8589934592</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">&quot;available&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2147483648</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">&quot;used&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">6442450944</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">&quot;percent&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">75.0</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">&quot;swap_total&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2147483648</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">&quot;swap_used&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1073741824</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">&quot;swap_percent&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">50.0</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">&quot;swap_available&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1073741824</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">&quot;memory_pressure_level&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;medium&quot;</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">&quot;timestamp&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1703123456.789</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span></code></pre><h3>Set Memory Pressure Thresholds</h3>
<p><strong>POST</strong> <code>/api/packages/memory/pressure-thresholds</code></p>
<p>Set custom memory pressure thresholds.</p>
<p><strong>Request:</strong></p>
<pre><code class="hljs language-json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">&quot;warning&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.6</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;unload_packages&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.8</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;aggressive_unload&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.85</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;emergency&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.9</span>
<span class="hljs-punctuation">}</span></code></pre><p><strong>Response:</strong></p>
<pre><code class="hljs language-json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">&quot;status&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;success&quot;</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;data&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">&quot;message&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Memory pressure thresholds updated&quot;</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">&quot;thresholds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">&quot;warning&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.6</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">&quot;unload_packages&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.8</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">&quot;aggressive_unload&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.85</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">&quot;emergency&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.9</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">&quot;update_time&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1703123456.789</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span></code></pre><h3>Toggle Memory Pressure Alerts</h3>
<p><strong>POST</strong> <code>/api/packages/memory/pressure-alerts/{enabled}</code></p>
<p>Enable or disable memory pressure alerts.</p>
<p><strong>Response:</strong></p>
<pre><code class="hljs language-json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">&quot;status&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;success&quot;</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;data&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">&quot;message&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Memory pressure alerts enabled&quot;</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">&quot;enabled&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">&quot;update_time&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1703123456.789</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span></code></pre><h3>Toggle Memory Optimization Suggestions</h3>
<p><strong>POST</strong> <code>/api/packages/memory/optimization-suggestions/{enabled}</code></p>
<p>Enable or disable memory optimization suggestions.</p>
<p><strong>Response:</strong></p>
<pre><code class="hljs language-json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">&quot;status&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;success&quot;</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;data&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">&quot;message&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Memory optimization suggestions enabled&quot;</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">&quot;enabled&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">&quot;update_time&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1703123456.789</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span></code></pre><h2>Configuration</h2>
<h3>Environment Variables</h3>
<p>Memory pressure management can be configured through environment variables:</p>
<pre><code class="hljs language-bash"><span class="hljs-comment"># Memory pressure thresholds</span>
LAZY_LOADING_UNLOADING_MEMORY_PRESSURE_THRESHOLD=0.8
LAZY_LOADING_UNLOADING_MEMORY_PRESSURE_TIMEOUT=60

<span class="hljs-comment"># Enable/disable features</span>
LAZY_LOADING_UNLOADING_ENABLE_MEMORY_PRESSURE_UNLOADING=<span class="hljs-literal">true</span>
LAZY_LOADING_UNLOADING_ENABLE_USAGE_PATTERN_UNLOADING=<span class="hljs-literal">true</span></code></pre><h3>Configuration File</h3>
<p>Settings can also be configured in the application configuration:</p>
<pre><code class="hljs language-json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">&quot;lazy_loading_unloading_memory_pressure_threshold&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.8</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;lazy_loading_unloading_memory_pressure_timeout&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">60</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;lazy_loading_unloading_enable_memory_pressure_unloading&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;lazy_loading_unloading_enable_usage_pattern_unloading&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span>
<span class="hljs-punctuation">}</span></code></pre><h2>Usage Examples</h2>
<h3>Basic Memory Monitoring</h3>
<pre><code class="hljs language-python"><span class="hljs-keyword">from</span> app.utils.lazy_loader <span class="hljs-keyword">import</span> get_lazy_loader

loader = get_lazy_loader()

<span class="hljs-comment"># Get memory pressure summary</span>
summary = loader.get_memory_pressure_summary()

<span class="hljs-comment"># Check for alerts</span>
<span class="hljs-keyword">if</span> summary[<span class="hljs-string">&quot;current_alerts&quot;</span>]:
    <span class="hljs-keyword">for</span> alert <span class="hljs-keyword">in</span> summary[<span class="hljs-string">&quot;current_alerts&quot;</span>]:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Alert: <span class="hljs-subst">{alert[<span class="hljs-string">&#x27;message&#x27;</span>]}</span>&quot;</span>)
        <span class="hljs-keyword">if</span> alert[<span class="hljs-string">&quot;action_required&quot;</span>]:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Action required!&quot;</span>)

<span class="hljs-comment"># Get optimization suggestions</span>
suggestions = loader.get_memory_optimization_suggestions()
<span class="hljs-keyword">for</span> suggestion <span class="hljs-keyword">in</span> suggestions:
    <span class="hljs-keyword">if</span> suggestion[<span class="hljs-string">&quot;severity&quot;</span>] == <span class="hljs-string">&quot;critical&quot;</span>:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Critical: <span class="hljs-subst">{suggestion[<span class="hljs-string">&#x27;message&#x27;</span>]}</span>&quot;</span>)</code></pre><h3>Custom Threshold Configuration</h3>
<pre><code class="hljs language-python"><span class="hljs-keyword">from</span> app.utils.lazy_loader <span class="hljs-keyword">import</span> get_lazy_loader

loader = get_lazy_loader()

<span class="hljs-comment"># Set custom thresholds for your environment</span>
custom_thresholds = {
    <span class="hljs-string">&quot;warning&quot;</span>: <span class="hljs-number">0.7</span>,        <span class="hljs-comment"># 70% - more conservative</span>
    <span class="hljs-string">&quot;unload_packages&quot;</span>: <span class="hljs-number">0.85</span>, <span class="hljs-comment"># 85% - start unloading later</span>
    <span class="hljs-string">&quot;aggressive_unload&quot;</span>: <span class="hljs-number">0.9</span>, <span class="hljs-comment"># 90% - aggressive unloading later</span>
    <span class="hljs-string">&quot;emergency&quot;</span>: <span class="hljs-number">0.95</span>,     <span class="hljs-comment"># 95% - emergency measures later</span>
}

loader.set_memory_pressure_thresholds(custom_thresholds)</code></pre><h3>Memory Pressure Response</h3>
<pre><code class="hljs language-python"><span class="hljs-keyword">from</span> app.utils.lazy_loader <span class="hljs-keyword">import</span> get_lazy_loader

loader = get_lazy_loader()

<span class="hljs-comment"># Get current memory pressure</span>
summary = loader.get_memory_pressure_summary()
pressure_level = summary[<span class="hljs-string">&quot;system_memory&quot;</span>][<span class="hljs-string">&quot;memory_pressure_level&quot;</span>]

<span class="hljs-keyword">if</span> pressure_level == <span class="hljs-string">&quot;critical&quot;</span>:
    <span class="hljs-comment"># Force garbage collection</span>
    gc_stats = loader.force_garbage_collection()
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Freed <span class="hljs-subst">{gc_stats[<span class="hljs-string">&#x27;memory_freed&#x27;</span>] / (<span class="hljs-number">1024</span>**<span class="hljs-number">2</span>):<span class="hljs-number">.1</span>f}</span>MB&quot;</span>)

    <span class="hljs-comment"># Get urgent suggestions</span>
    suggestions = loader.get_memory_optimization_suggestions()
    critical_suggestions = [s <span class="hljs-keyword">for</span> s <span class="hljs-keyword">in</span> suggestions <span class="hljs-keyword">if</span> s[<span class="hljs-string">&quot;severity&quot;</span>] == <span class="hljs-string">&quot;critical&quot;</span>]

    <span class="hljs-keyword">for</span> suggestion <span class="hljs-keyword">in</span> critical_suggestions:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Critical action: <span class="hljs-subst">{suggestion[<span class="hljs-string">&#x27;recommendation&#x27;</span>]}</span>&quot;</span>)</code></pre><h2>Best Practices</h2>
<h3>Monitoring</h3>
<ol>
<li><strong>Regular Monitoring</strong>: Check memory pressure summary regularly</li>
<li><strong>Alert Configuration</strong>: Set appropriate thresholds for your environment</li>
<li><strong>Trend Analysis</strong>: Monitor memory usage trends over time</li>
</ol>
<h3>Optimization</h3>
<ol>
<li><strong>Proactive Unloading</strong>: Use memory optimization suggestions proactively</li>
<li><strong>Threshold Tuning</strong>: Adjust thresholds based on your workload</li>
<li><strong>Garbage Collection</strong>: Use forced garbage collection when needed</li>
</ol>
<h3>Troubleshooting</h3>
<ol>
<li><strong>High Memory Usage</strong>: Check for memory leaks in packages</li>
<li><strong>Frequent Alerts</strong>: Adjust thresholds or investigate memory growth</li>
<li><strong>Swap Usage</strong>: Monitor swap usage to avoid thrashing</li>
</ol>
<h2>Performance Impact</h2>
<p>The memory pressure management system is designed to have minimal performance impact:</p>
<ul>
<li><strong>Monitoring Overhead</strong>: &lt; 1ms per check</li>
<li><strong>Alert Generation</strong>: &lt; 0.1ms per alert</li>
<li><strong>Suggestion Generation</strong>: &lt; 1ms per suggestion</li>
<li><strong>Memory Footprint</strong>: &lt; 1MB additional memory usage</li>
</ul>
<h2>Integration with Existing Systems</h2>
<p>The memory pressure management system integrates seamlessly with:</p>
<ul>
<li><strong>Package Unloading System</strong>: Enhanced unloading based on memory pressure</li>
<li><strong>Memory Tracking</strong>: Leverages existing memory metrics</li>
<li><strong>Configuration System</strong>: Uses existing configuration infrastructure</li>
<li><strong>API Framework</strong>: Extends existing API endpoints</li>
<li><strong>Logging System</strong>: Integrates with existing logging infrastructure</li>
</ul>
<h2>Future Enhancements</h2>
<p>Planned enhancements include:</p>
<ul>
<li><strong>Machine Learning</strong>: Predictive memory pressure detection</li>
<li><strong>Advanced Analytics</strong>: Detailed memory usage analytics</li>
<li><strong>Integration</strong>: Integration with external monitoring systems</li>
<li><strong>Custom Actions</strong>: User-defined actions for memory pressure events</li>
<li><strong>Historical Analysis</strong>: Long-term memory usage trend analysis</li>
</ul>
</div>
    </div>
  </main>
  <footer class="docs-footer"><p>&copy; 2024 Reynard Documentation Test. Built with ❤️ using SolidJS.</p></footer>
</body>
</html>