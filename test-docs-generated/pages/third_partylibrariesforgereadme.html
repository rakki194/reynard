<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Forge - Task Queue Core Library - Reynard Documentation Test</title>
  <link rel="stylesheet" href="../styles.css">
  <link rel="stylesheet" href="../highlight.css">
  <link rel="icon" href="/favicon.ico">
</head>
<body>
  <nav class="docs-nav">
    <div class="nav-brand"><a href="../index.html">Reynard Documentation Test</a></div>
    <div class="nav-links"><a href="../index.html">Home</a><a href="../api.html">API Reference</a></div>
  </nav>
  <main class="docs-main">
    <div class="docs-content">
      <h1>Forge - Task Queue Core Library</h1>
      <div class="markdown-content"><h1>Forge - Task Queue Core Library</h1>
<p>A comprehensive task queue library for efficient task processing and management. Forge provides multiple queue types including basic threaded queues, priority queues, and database-backed job queues with advanced features like metrics, monitoring, and optimization.</p>
<h2>Features</h2>
<ul>
<li><strong>Multiple Queue Types</strong>: Basic threaded queues, priority queues, and database-backed job queues</li>
<li><strong>Advanced Metrics</strong>: Comprehensive performance monitoring and health checks</li>
<li><strong>Multiple Backends</strong>: Memory, Redis, and database storage options</li>
<li><strong>Priority Support</strong>: Dynamic priority calculation and optimization</li>
<li><strong>Worker Management</strong>: Configurable worker threads with health monitoring</li>
<li><strong>Persistence</strong>: Database and Redis backends for data persistence</li>
<li><strong>Retry Logic</strong>: Configurable retry mechanisms with exponential backoff</li>
<li><strong>Monitoring</strong>: Real-time metrics, health checks, and performance analysis</li>
<li><strong>Type Safety</strong>: Full type hints and validation</li>
</ul>
<h2>Installation</h2>
<pre><code class="hljs language-bash">pip install forge</code></pre><h3>Optional Dependencies</h3>
<p>For Redis backend:</p>
<pre><code class="hljs language-bash">pip install redis</code></pre><p>For database backend:</p>
<pre><code class="hljs language-bash">pip install sqlalchemy</code></pre><h2>Quick Start</h2>
<h3>Basic Task Queue</h3>
<pre><code class="hljs language-python"><span class="hljs-keyword">from</span> forge <span class="hljs-keyword">import</span> TaskQueue
<span class="hljs-keyword">import</span> time

<span class="hljs-keyword">def</span> <span class="hljs-title function_">example_task</span>(<span class="hljs-params">x</span>):
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Processing task <span class="hljs-subst">{x}</span>&quot;</span>)
    time.sleep(<span class="hljs-number">1</span>)

<span class="hljs-comment"># Create and use task queue</span>
<span class="hljs-keyword">with</span> TaskQueue(num_workers=<span class="hljs-number">3</span>) <span class="hljs-keyword">as</span> queue:
    <span class="hljs-comment"># Add tasks</span>
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>):
        queue.add_task(example_task, i, priority=i % <span class="hljs-number">3</span>)
    
    <span class="hljs-comment"># Wait for completion</span>
    queue.wait_completion()
    
    <span class="hljs-comment"># Print metrics</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Metrics:&quot;</span>, queue.get_metrics())</code></pre><h3>Priority Queue Engine</h3>
<pre><code class="hljs language-python"><span class="hljs-keyword">from</span> forge <span class="hljs-keyword">import</span> PriorityQueueEngine, LoadingStrategy, PackageInfo

<span class="hljs-comment"># Create priority queue engine</span>
pq = PriorityQueueEngine(max_concurrent_loads=<span class="hljs-number">3</span>)

<span class="hljs-comment"># Register packages</span>
package_info = PackageInfo(
    name=<span class="hljs-string">&quot;my_package&quot;</span>,
    dependencies=[<span class="hljs-string">&quot;dep1&quot;</span>, <span class="hljs-string">&quot;dep2&quot;</span>],
    usage_count=<span class="hljs-number">10</span>,
    load_time=<span class="hljs-number">2.5</span>
)
pq.register_package(package_info)

<span class="hljs-comment"># Enqueue packages</span>
pq.enqueue_package(<span class="hljs-string">&quot;my_package&quot;</span>, LoadingStrategy.EAGER)

<span class="hljs-comment"># Get performance analysis</span>
analysis = pq.analyze_performance()
<span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Throughput: <span class="hljs-subst">{analysis.throughput}</span> items/sec&quot;</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Error rate: <span class="hljs-subst">{analysis.error_rate}</span>%&quot;</span>)</code></pre><h3>Job Queue with Database Backend</h3>
<pre><code class="hljs language-python"><span class="hljs-keyword">from</span> forge <span class="hljs-keyword">import</span> JobQueue, JobRequest, JobType
<span class="hljs-keyword">from</span> forge.backends <span class="hljs-keyword">import</span> DatabaseBackend

<span class="hljs-comment"># Create database backend</span>
backend = DatabaseBackend(<span class="hljs-string">&quot;sqlite:///jobs.db&quot;</span>)
backend.connect()

<span class="hljs-comment"># Create job queue</span>
job_queue = JobQueue(backend=backend, max_workers=<span class="hljs-number">4</span>)

<span class="hljs-comment"># Register custom job handler</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">handle_custom_job</span>(<span class="hljs-params">payload</span>):
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Processing custom job: <span class="hljs-subst">{payload}</span>&quot;</span>)
    <span class="hljs-keyword">return</span> {<span class="hljs-string">&quot;status&quot;</span>: <span class="hljs-string">&quot;completed&quot;</span>, <span class="hljs-string">&quot;result&quot;</span>: <span class="hljs-string">&quot;success&quot;</span>}

job_queue.register_handler(JobType.CUSTOM, handle_custom_job)

<span class="hljs-comment"># Start the queue</span>
<span class="hljs-keyword">with</span> job_queue:
    <span class="hljs-comment"># Submit jobs</span>
    job_request = JobRequest(
        job_type=JobType.CUSTOM,
        payload={<span class="hljs-string">&quot;data&quot;</span>: <span class="hljs-string">&quot;example&quot;</span>},
        priority=<span class="hljs-number">1</span>
    )
    job_id = job_queue.submit_job(job_request)
    
    <span class="hljs-comment"># Check job status</span>
    status = job_queue.get_job_status(job_id)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Job status: <span class="hljs-subst">{status}</span>&quot;</span>)</code></pre><h2>Core Components</h2>
<h3>TaskQueue</h3>
<p>Basic threaded task queue for simple background processing:</p>
<pre><code class="hljs language-python"><span class="hljs-keyword">from</span> forge <span class="hljs-keyword">import</span> TaskQueue

queue = TaskQueue(
    num_workers=<span class="hljs-number">4</span>,        <span class="hljs-comment"># Number of worker threads</span>
    queue_size=<span class="hljs-number">1000</span>,      <span class="hljs-comment"># Maximum queue size</span>
    task_timeout=<span class="hljs-number">30.0</span>,    <span class="hljs-comment"># Task timeout in seconds</span>
    enable_metrics=<span class="hljs-literal">True</span>   <span class="hljs-comment"># Enable performance metrics</span>
)

<span class="hljs-comment"># Add tasks with priority</span>
queue.add_task(
    my_function, 
    arg1, arg2, 
    priority=<span class="hljs-number">1</span>,
    task_id=<span class="hljs-string">&quot;unique_id&quot;</span>,
    tags=[<span class="hljs-string">&quot;important&quot;</span>, <span class="hljs-string">&quot;urgent&quot;</span>]
)</code></pre><h3>PriorityQueueEngine</h3>
<p>Advanced priority queue with dynamic priority calculation:</p>
<pre><code class="hljs language-python"><span class="hljs-keyword">from</span> forge <span class="hljs-keyword">import</span> PriorityQueueEngine, LoadingStrategy, PriorityWeights

<span class="hljs-comment"># Configure priority weights</span>
weights = PriorityWeights(
    usage_frequency=<span class="hljs-number">0.4</span>,    <span class="hljs-comment"># 40% weight</span>
    startup_impact=<span class="hljs-number">0.3</span>,     <span class="hljs-comment"># 30% weight</span>
    dependency_depth=<span class="hljs-number">0.2</span>,   <span class="hljs-comment"># 20% weight</span>
    user_preference=<span class="hljs-number">0.1</span>     <span class="hljs-comment"># 10% weight</span>
)

pq = PriorityQueueEngine(max_concurrent_loads=<span class="hljs-number">3</span>)
pq.set_priority_weights(weights)

<span class="hljs-comment"># Register packages for priority calculation</span>
package_info = PackageInfo(
    name=<span class="hljs-string">&quot;critical_package&quot;</span>,
    dependencies=[],
    usage_count=<span class="hljs-number">100</span>,
    load_time=<span class="hljs-number">0.5</span>,
    user_preference_priority=<span class="hljs-number">1</span>
)
pq.register_package(package_info)</code></pre><h3>JobQueue</h3>
<p>Database-backed job queue for persistent job processing:</p>
<pre><code class="hljs language-python"><span class="hljs-keyword">from</span> forge <span class="hljs-keyword">import</span> JobQueue, JobRequest, JobType
<span class="hljs-keyword">from</span> forge.backends <span class="hljs-keyword">import</span> DatabaseBackend

<span class="hljs-comment"># Create backend</span>
backend = DatabaseBackend(<span class="hljs-string">&quot;postgresql://user:pass@localhost/forge&quot;</span>)

<span class="hljs-comment"># Create job queue</span>
job_queue = JobQueue(
    backend=backend,
    max_workers=<span class="hljs-number">4</span>,
    enable_metrics=<span class="hljs-literal">True</span>
)

<span class="hljs-comment"># Register job handlers</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">process_data_job</span>(<span class="hljs-params">payload</span>):
    <span class="hljs-comment"># Process the job</span>
    data = payload[<span class="hljs-string">&quot;data&quot;</span>]
    result = process_data(data)
    <span class="hljs-keyword">return</span> {<span class="hljs-string">&quot;processed&quot;</span>: <span class="hljs-literal">True</span>, <span class="hljs-string">&quot;result&quot;</span>: result}

job_queue.register_handler(JobType.CUSTOM, process_data_job)

<span class="hljs-comment"># Submit jobs</span>
job_request = JobRequest(
    job_type=JobType.CUSTOM,
    payload={<span class="hljs-string">&quot;data&quot;</span>: <span class="hljs-string">&quot;example_data&quot;</span>},
    priority=<span class="hljs-number">5</span>,
    max_retries=<span class="hljs-number">3</span>,
    timeout=<span class="hljs-number">300</span>,
    tags=[<span class="hljs-string">&quot;data_processing&quot;</span>]
)

job_id = job_queue.submit_job(job_request)</code></pre><h2>Backends</h2>
<h3>Memory Backend</h3>
<p>Fast in-memory storage for testing and development:</p>
<pre><code class="hljs language-python"><span class="hljs-keyword">from</span> forge.backends <span class="hljs-keyword">import</span> MemoryBackend

backend = MemoryBackend()
backend.connect()

<span class="hljs-comment"># Use with any queue type</span>
queue = TaskQueue(backend=backend)</code></pre><h3>Redis Backend</h3>
<p>Distributed queue storage with Redis:</p>
<pre><code class="hljs language-python"><span class="hljs-keyword">from</span> forge.backends <span class="hljs-keyword">import</span> RedisBackend

backend = RedisBackend(
    host=<span class="hljs-string">&quot;localhost&quot;</span>,
    port=<span class="hljs-number">6379</span>,
    db=<span class="hljs-number">0</span>,
    password=<span class="hljs-string">&quot;your_password&quot;</span>,
    prefix=<span class="hljs-string">&quot;forge:queue:&quot;</span>,
    default_ttl=<span class="hljs-number">3600</span>
)

backend.connect()</code></pre><h3>Database Backend</h3>
<p>Persistent storage with SQLAlchemy:</p>
<pre><code class="hljs language-python"><span class="hljs-keyword">from</span> forge.backends <span class="hljs-keyword">import</span> DatabaseBackend

backend = DatabaseBackend(
    database_url=<span class="hljs-string">&quot;postgresql://user:pass@localhost/forge&quot;</span>,
    table_prefix=<span class="hljs-string">&quot;forge_&quot;</span>,
    cleanup_interval=<span class="hljs-number">3600</span>,
    max_retries=<span class="hljs-number">3</span>
)

backend.connect()</code></pre><h2>Monitoring and Metrics</h2>
<h3>Performance Analysis</h3>
<pre><code class="hljs language-python"><span class="hljs-comment"># Get comprehensive performance analysis</span>
analysis = pq.analyze_performance()

<span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Throughput: <span class="hljs-subst">{analysis.throughput}</span> items/sec&quot;</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Latency P50: <span class="hljs-subst">{analysis.latency_p50:<span class="hljs-number">.3</span>f}</span>s&quot;</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Latency P95: <span class="hljs-subst">{analysis.latency_p95:<span class="hljs-number">.3</span>f}</span>s&quot;</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Error Rate: <span class="hljs-subst">{analysis.error_rate:<span class="hljs-number">.2</span>f}</span>%&quot;</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Retry Rate: <span class="hljs-subst">{analysis.retry_rate:<span class="hljs-number">.2</span>f}</span>%&quot;</span>)

<span class="hljs-comment"># Get optimization suggestions</span>
<span class="hljs-keyword">for</span> suggestion <span class="hljs-keyword">in</span> analysis.optimization_suggestions:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Suggestion: <span class="hljs-subst">{suggestion}</span>&quot;</span>)</code></pre><h3>Health Monitoring</h3>
<pre><code class="hljs language-python"><span class="hljs-comment"># Check queue health</span>
health = pq.check_health()

<span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Health Score: <span class="hljs-subst">{health.health_score:<span class="hljs-number">.2</span>f}</span>&quot;</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Status: <span class="hljs-subst">{health.status}</span>&quot;</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Stuck Items: <span class="hljs-subst">{health.stuck_items_count}</span>&quot;</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Queue Size: <span class="hljs-subst">{health.queue_size}</span>&quot;</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Error Rate: <span class="hljs-subst">{health.error_rate:<span class="hljs-number">.2</span>f}</span>%&quot;</span>)

<span class="hljs-comment"># Get alerts</span>
<span class="hljs-keyword">for</span> alert <span class="hljs-keyword">in</span> health.alerts:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Alert: <span class="hljs-subst">{alert}</span>&quot;</span>)</code></pre><h3>Queue Metrics</h3>
<pre><code class="hljs language-python"><span class="hljs-comment"># Get queue statistics</span>
stats = job_queue.get_queue_stats()

<span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Jobs Submitted: <span class="hljs-subst">{stats[<span class="hljs-string">&#x27;jobs_submitted&#x27;</span>]}</span>&quot;</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Jobs Completed: <span class="hljs-subst">{stats[<span class="hljs-string">&#x27;jobs_completed&#x27;</span>]}</span>&quot;</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Jobs Failed: <span class="hljs-subst">{stats[<span class="hljs-string">&#x27;jobs_failed&#x27;</span>]}</span>&quot;</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Active Workers: <span class="hljs-subst">{stats[<span class="hljs-string">&#x27;active_workers&#x27;</span>]}</span>&quot;</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Success Rate: <span class="hljs-subst">{stats.get(<span class="hljs-string">&#x27;success_rate&#x27;</span>, <span class="hljs-number">0</span>):<span class="hljs-number">.2</span>f}</span>%&quot;</span>)

<span class="hljs-comment"># Get worker statistics</span>
worker_stats = job_queue.get_worker_stats()
<span class="hljs-keyword">for</span> worker_id, stats <span class="hljs-keyword">in</span> worker_stats.items():
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Worker <span class="hljs-subst">{worker_id}</span>: <span class="hljs-subst">{stats[<span class="hljs-string">&#x27;tasks_processed&#x27;</span>]}</span> tasks processed&quot;</span>)</code></pre><h2>Advanced Features</h2>
<h3>Priority Optimization</h3>
<pre><code class="hljs language-python"><span class="hljs-comment"># Optimize load order based on priorities and dependencies</span>
packages = [<span class="hljs-string">&quot;pkg1&quot;</span>, <span class="hljs-string">&quot;pkg2&quot;</span>, <span class="hljs-string">&quot;pkg3&quot;</span>, <span class="hljs-string">&quot;pkg4&quot;</span>]
optimized_order, optimization_data = pq.optimize_load_order(packages)

<span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Optimized order: <span class="hljs-subst">{optimized_order}</span>&quot;</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Optimization score: <span class="hljs-subst">{optimization_data.optimization_score:<span class="hljs-number">.3</span>f}</span>&quot;</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Time saved: <span class="hljs-subst">{optimization_data.estimated_time_saved:<span class="hljs-number">.2</span>f}</span>s&quot;</span>)</code></pre><h3>Health Callbacks</h3>
<pre><code class="hljs language-python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">health_callback</span>(<span class="hljs-params">health_metrics</span>):
    <span class="hljs-keyword">if</span> health_metrics.status == <span class="hljs-string">&quot;critical&quot;</span>:
        <span class="hljs-comment"># Send alert</span>
        send_alert(<span class="hljs-string">f&quot;Queue health critical: <span class="hljs-subst">{health_metrics.health_score}</span>&quot;</span>)

<span class="hljs-keyword">def</span> <span class="hljs-title function_">performance_callback</span>(<span class="hljs-params">performance_analysis</span>):
    <span class="hljs-keyword">if</span> performance_analysis.error_rate &gt; <span class="hljs-number">10</span>:
        <span class="hljs-comment"># Log high error rate</span>
        log_error(<span class="hljs-string">f&quot;High error rate: <span class="hljs-subst">{performance_analysis.error_rate}</span>%&quot;</span>)

<span class="hljs-comment"># Register callbacks</span>
pq.add_health_callback(health_callback)
pq.add_performance_callback(performance_callback)</code></pre><h3>Custom Job Types</h3>
<pre><code class="hljs language-python"><span class="hljs-keyword">from</span> enum <span class="hljs-keyword">import</span> Enum

<span class="hljs-keyword">class</span> <span class="hljs-title class_">CustomJobType</span>(<span class="hljs-built_in">str</span>, Enum):
    EMAIL_SEND = <span class="hljs-string">&quot;email_send&quot;</span>
    DATA_ANALYSIS = <span class="hljs-string">&quot;data_analysis&quot;</span>
    REPORT_GENERATION = <span class="hljs-string">&quot;report_generation&quot;</span>

<span class="hljs-comment"># Register handlers for custom job types</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">send_email_job</span>(<span class="hljs-params">payload</span>):
    recipient = payload[<span class="hljs-string">&quot;recipient&quot;</span>]
    subject = payload[<span class="hljs-string">&quot;subject&quot;</span>]
    body = payload[<span class="hljs-string">&quot;body&quot;</span>]
    <span class="hljs-comment"># Send email logic</span>
    <span class="hljs-keyword">return</span> {<span class="hljs-string">&quot;sent&quot;</span>: <span class="hljs-literal">True</span>, <span class="hljs-string">&quot;message_id&quot;</span>: <span class="hljs-string">&quot;msg_123&quot;</span>}

<span class="hljs-keyword">def</span> <span class="hljs-title function_">analyze_data_job</span>(<span class="hljs-params">payload</span>):
    data = payload[<span class="hljs-string">&quot;data&quot;</span>]
    <span class="hljs-comment"># Data analysis logic</span>
    <span class="hljs-keyword">return</span> {<span class="hljs-string">&quot;analysis_complete&quot;</span>: <span class="hljs-literal">True</span>, <span class="hljs-string">&quot;insights&quot;</span>: [<span class="hljs-string">&quot;insight1&quot;</span>, <span class="hljs-string">&quot;insight2&quot;</span>]}

job_queue.register_handler(CustomJobType.EMAIL_SEND, send_email_job)
job_queue.register_handler(CustomJobType.DATA_ANALYSIS, analyze_data_job)</code></pre><h2>Configuration</h2>
<h3>Environment Variables</h3>
<pre><code class="hljs language-bash"><span class="hljs-comment"># Redis configuration</span>
FORGE_REDIS_HOST=localhost
FORGE_REDIS_PORT=6379
FORGE_REDIS_PASSWORD=your_password
FORGE_REDIS_DB=0

<span class="hljs-comment"># Database configuration</span>
FORGE_DATABASE_URL=postgresql://user:pass@localhost/forge
FORGE_DATABASE_PREFIX=forge_

<span class="hljs-comment"># Queue configuration</span>
FORGE_MAX_WORKERS=4
FORGE_QUEUE_SIZE=1000
FORGE_TASK_TIMEOUT=30</code></pre><h3>Configuration File</h3>
<pre><code class="hljs language-python"><span class="hljs-keyword">import</span> os
<span class="hljs-keyword">from</span> forge <span class="hljs-keyword">import</span> TaskQueue

<span class="hljs-comment"># Load configuration from environment</span>
config = {
    <span class="hljs-string">&quot;num_workers&quot;</span>: <span class="hljs-built_in">int</span>(os.getenv(<span class="hljs-string">&quot;FORGE_MAX_WORKERS&quot;</span>, <span class="hljs-number">4</span>)),
    <span class="hljs-string">&quot;queue_size&quot;</span>: <span class="hljs-built_in">int</span>(os.getenv(<span class="hljs-string">&quot;FORGE_QUEUE_SIZE&quot;</span>, <span class="hljs-number">1000</span>)),
    <span class="hljs-string">&quot;task_timeout&quot;</span>: <span class="hljs-built_in">float</span>(os.getenv(<span class="hljs-string">&quot;FORGE_TASK_TIMEOUT&quot;</span>, <span class="hljs-number">30.0</span>)),
    <span class="hljs-string">&quot;enable_metrics&quot;</span>: <span class="hljs-literal">True</span>
}

queue = TaskQueue(**config)</code></pre><h2>Testing</h2>
<pre><code class="hljs language-python"><span class="hljs-keyword">import</span> pytest
<span class="hljs-keyword">from</span> forge <span class="hljs-keyword">import</span> TaskQueue, JobQueue
<span class="hljs-keyword">from</span> forge.backends <span class="hljs-keyword">import</span> MemoryBackend

<span class="hljs-keyword">def</span> <span class="hljs-title function_">test_task_queue</span>():
    <span class="hljs-keyword">with</span> TaskQueue(num_workers=<span class="hljs-number">2</span>) <span class="hljs-keyword">as</span> queue:
        results = []
        
        <span class="hljs-keyword">def</span> <span class="hljs-title function_">test_task</span>(<span class="hljs-params">x</span>):
            results.append(x)
        
        <span class="hljs-comment"># Add tasks</span>
        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">5</span>):
            queue.add_task(test_task, i)
        
        <span class="hljs-comment"># Wait for completion</span>
        queue.wait_completion()
        
        <span class="hljs-comment"># Verify results</span>
        <span class="hljs-keyword">assert</span> <span class="hljs-built_in">len</span>(results) == <span class="hljs-number">5</span>
        <span class="hljs-keyword">assert</span> <span class="hljs-built_in">set</span>(results) == {<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>}

<span class="hljs-keyword">def</span> <span class="hljs-title function_">test_job_queue</span>():
    backend = MemoryBackend()
    backend.connect()
    
    <span class="hljs-keyword">with</span> JobQueue(backend=backend, max_workers=<span class="hljs-number">2</span>) <span class="hljs-keyword">as</span> job_queue:
        <span class="hljs-keyword">def</span> <span class="hljs-title function_">test_job_handler</span>(<span class="hljs-params">payload</span>):
            <span class="hljs-keyword">return</span> {<span class="hljs-string">&quot;processed&quot;</span>: <span class="hljs-literal">True</span>, <span class="hljs-string">&quot;data&quot;</span>: payload[<span class="hljs-string">&quot;data&quot;</span>]}
        
        job_queue.register_handler(JobType.CUSTOM, test_job_handler)
        
        <span class="hljs-comment"># Submit job</span>
        job_request = JobRequest(
            job_type=JobType.CUSTOM,
            payload={<span class="hljs-string">&quot;data&quot;</span>: <span class="hljs-string">&quot;test&quot;</span>}
        )
        job_id = job_queue.submit_job(job_request)
        
        <span class="hljs-comment"># Wait a bit for processing</span>
        <span class="hljs-keyword">import</span> time
        time.sleep(<span class="hljs-number">0.1</span>)
        
        <span class="hljs-comment"># Check status</span>
        status = job_queue.get_job_status(job_id)
        <span class="hljs-keyword">assert</span> status[<span class="hljs-string">&quot;status&quot;</span>] == <span class="hljs-string">&quot;completed&quot;</span></code></pre><h2>Contributing</h2>
<ol>
<li>Fork the repository</li>
<li>Create a feature branch</li>
<li>Make your changes</li>
<li>Add tests</li>
<li>Run the test suite</li>
<li>Submit a pull request</li>
</ol>
<h2>License</h2>
<p>MIT License - see LICENSE file for details.</p>
<h2>Support</h2>
<ul>
<li>Documentation: <a href="https://forge.readthedocs.io">https://forge.readthedocs.io</a></li>
<li>Issues: <a href="https://github.com/runeset/forge/issues">https://github.com/runeset/forge/issues</a></li>
<li>Discussions: <a href="https://github.com/runeset/forge/discussions">https://github.com/runeset/forge/discussions</a></li>
</ul>
</div>
    </div>
  </main>
  <footer class="docs-footer"><p>&copy; 2024 Reynard Documentation Test. Built with ❤️ using SolidJS.</p></footer>
</body>
</html>